{"version":3,"sources":["app/application.coffee","app/collections/files.coffee","app/initialize.coffee","app/lib/base_view.coffee","app/lib/basic.coffee","app/lib/device_status.coffee","app/lib/persistent_log.coffee","app/lib/request.js","app/lib/utils.coffee","app/lib/view_collection.coffee","app/locales/en.coffee","app/locales/es.coffee","app/locales/fr.coffee","app/models/contact.coffee","app/models/file.coffee","app/replicator/filesystem.coffee","app/replicator/main.coffee","app/replicator/replicator_backups.coffee","app/replicator/replicator_config.coffee","app/replicator/replicator_contacts.coffee","app/replicator/replicator_mapreduce.coffee","app/router.coffee","app/service/service.coffee","app/service/service_manager.coffee","app/templates/breadcrumbs.jade","app/templates/breadcrumbs_element.jade","app/templates/config.jade","app/templates/device_name_picker.jade","app/templates/first_sync.jade","app/templates/folder_line.jade","app/templates/layout.jade","app/templates/login.jade","app/templates/menu.jade","app/views/breadcrumbs.coffee","app/views/config.coffee","app/views/device_name_picker.coffee","app/views/first_sync.coffee","app/views/folder.coffee","app/views/folder_line.coffee","app/views/layout.coffee","app/views/login.coffee","app/views/menu.coffee","app/views/notifications.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5IA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtOA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3CA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxKA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5dA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjRA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1CA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtTA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjvBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtYA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhZA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3LA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7HA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1FA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7GA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzKA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtQA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtMA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApHA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnFA;AAAA","file":"../www/javascripts/app.js","sourcesContent":["var DeviceStatus, LayoutView, Notifications, Replicator, ServiceManager, log;\n\nrequire('/lib/utils');\n\nReplicator = require('./replicator/main');\n\nLayoutView = require('./views/layout');\n\nServiceManager = require('./service/service_manager');\n\nNotifications = require('../views/notifications');\n\nDeviceStatus = require('./lib/device_status');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"application\",\n  date: true,\n  processusTag: \"Application\"\n});\n\nmodule.exports = {\n  initialize: function() {\n    window.app = this;\n    if (window.isBrowserDebugging) {\n      window.navigator = window.navigator || {};\n      window.navigator.globalization = window.navigator.globalization || {};\n      window.navigator.globalization.getPreferredLanguage = function(callback) {\n        return callback({\n          value: 'fr-FR'\n        });\n      };\n    }\n    return navigator.globalization.getPreferredLanguage((function(_this) {\n      return function(properties) {\n        var Router, e, locales;\n        _this.locale = properties.value.split('-')[0];\n        _this.polyglot = new Polyglot();\n        locales = (function() {\n          try {\n            return require('locales/' + this.locale);\n          } catch (_error) {\n            e = _error;\n            return require('locales/en');\n          }\n        }).call(_this);\n        _this.polyglot.extend(locales);\n        window.t = _this.polyglot.t.bind(_this.polyglot);\n        Router = require('router');\n        _this.router = new Router();\n        _this.replicator = new Replicator();\n        _this.layout = new LayoutView();\n        return _this.replicator.init(function(err, config) {\n          if (err) {\n            log.error(err);\n            return alert(err.message || err);\n          }\n          if (!window.isBrowserDebugging) {\n            _this.notificationManager = new Notifications();\n            _this.serviceManager = new ServiceManager();\n          }\n          $('body').empty().append(_this.layout.render().$el);\n          Backbone.history.start();\n          DeviceStatus.initialize();\n          if (config.remote) {\n            if (!_this.replicator.config.has('checkpointed')) {\n              log.info('Launch first replication again.');\n              app.replicator.initialReplication(function(err) {});\n              if (err) {\n                log.error(err);\n                alert(t(err.message));\n              }\n              return app.router.navigate('first-sync', {\n                trigger: true\n              });\n            } else {\n              return app.regularStart();\n            }\n          } else {\n            return _this.router.navigate('login', {\n              trigger: true\n            });\n          }\n        });\n      };\n    })(this));\n  },\n  regularStart: function() {\n    var conf;\n    app.foreground = true;\n    conf = app.replicator.config.attributes;\n    log.info(\"Start v\" + (app.replicator.config.appVersion()) + \"--sync_contacts:\" + conf.syncContacts + \",sync_images:\" + conf.syncImages + \",sync_on_wifi:\" + conf.syncOnWifi + \",cozy_notifications:\" + conf.cozyNotifications);\n    document.addEventListener(\"resume\", (function(_this) {\n      return function() {\n        log.info(\"RESUME EVENT\");\n        app.foreground = true;\n        if (app.backFromOpen) {\n          app.backFromOpen = false;\n          return app.replicator.startRealtime();\n        } else {\n          return app.replicator.backup({}, function(err) {\n            if (err) {\n              return log.error(err);\n            }\n          });\n        }\n      };\n    })(this), false);\n    document.addEventListener(\"pause\", (function(_this) {\n      return function() {\n        log.info(\"PAUSE EVENT\");\n        app.foreground = false;\n        return app.replicator.stopRealtime();\n      };\n    })(this), false);\n    document.addEventListener('online', function() {\n      var backup;\n      backup = function() {\n        app.replicator.backup({}, function(err) {\n          if (err) {\n            return log.error(err);\n          }\n        });\n        return window.removeEventListener('realtime:onChange', backup, false);\n      };\n      return window.addEventListener('realtime:onChange', backup, false);\n    }, false);\n    this.router.navigate('folder/', {\n      trigger: true\n    });\n    return this.router.once('collectionfetched', (function(_this) {\n      return function() {\n        return app.replicator.backup({}, function(err) {\n          if (err) {\n            return log.error(err);\n          }\n        });\n      };\n    })(this));\n  }\n};\n","var File, FileAndFolderCollection, PAGE_LENGTH, log,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nFile = require('../models/file');\n\nPAGE_LENGTH = 20;\n\nlog = require('/lib/persistent_log')({\n  prefix: \"files collections\",\n  date: true\n});\n\nmodule.exports = FileAndFolderCollection = (function(_super) {\n  __extends(FileAndFolderCollection, _super);\n\n  function FileAndFolderCollection() {\n    return FileAndFolderCollection.__super__.constructor.apply(this, arguments);\n  }\n\n  FileAndFolderCollection.prototype.model = File;\n\n  FileAndFolderCollection.cache = {};\n\n  FileAndFolderCollection.prototype.initialize = function(models, options) {\n    this.path = options.path;\n    this.query = options.query;\n    return this.notloaded = true;\n  };\n\n  FileAndFolderCollection.prototype.isSearch = function() {\n    return this.path === void 0;\n  };\n\n  FileAndFolderCollection.prototype.search = function(callback) {\n    var params;\n    params = {\n      query: this.query,\n      fields: ['name'],\n      include_docs: true\n    };\n    return app.replicator.db.search(params, (function(_this) {\n      return function(err, items) {\n        return _this.slowReset(items, function(err) {\n          _this.notloaded = false;\n          _this.trigger('sync');\n          return callback(err);\n        });\n      };\n    })(this));\n  };\n\n  FileAndFolderCollection.prototype.fetch = function(callback) {\n    if (callback == null) {\n      callback = function() {};\n    }\n    this.offset = 0;\n    return this._fetchPathes(this.path, (function(_this) {\n      return function(err, results) {\n        _this.inPathIds = results.rows.map(function(row) {\n          return row.id;\n        });\n        _this.loadNextPage(callback);\n        return _this.trigger('fullsync');\n      };\n    })(this));\n  };\n\n  FileAndFolderCollection.prototype.loadNextPage = function(_callback) {\n    var callback;\n    callback = (function(_this) {\n      return function(err, noMoreItems) {\n        _this.notloaded = false;\n        _this.trigger('sync');\n        return _callback(err, noMoreItems);\n      };\n    })(this);\n    return this._fetchNextPageDocs((function(_this) {\n      return function(err, items) {\n        var models;\n        if (err) {\n          return callback(err);\n        }\n        models = _this._rowsToModels(items);\n        _this.allPagesLoaded = models.length < PAGE_LENGTH;\n        if (_this.offset === 0) {\n          _this.reset(models);\n        } else {\n          _this.add(models);\n        }\n        _this.offset += PAGE_LENGTH;\n        return callback(err, _this.allPagesLoaded);\n      };\n    })(this));\n  };\n\n  FileAndFolderCollection.prototype._fetchPathes = function(path, callback) {\n    var params, view;\n    if (path === t('photos')) {\n      params = {\n        endkey: path ? ['/' + path] : [''],\n        startkey: path ? ['/' + path, {}] : ['', {}],\n        descending: true\n      };\n      view = 'Pictures';\n    } else {\n      params = {\n        startkey: path ? ['/' + path] : [''],\n        endkey: path ? ['/' + path, {}] : ['', {}]\n      };\n      view = 'FilesAndFolder';\n    }\n    return app.replicator.db.query(view, params, callback);\n  };\n\n  FileAndFolderCollection.prototype._fetchNextPageDocs = function(callback) {\n    var ids, params;\n    ids = this.inPathIds.slice(this.offset, this.offset + PAGE_LENGTH);\n    params = {\n      keys: ids,\n      include_docs: true\n    };\n    return app.replicator.db.allDocs(params, callback);\n  };\n\n  FileAndFolderCollection.prototype._rowsToModels = function(results) {\n    return results.rows.map(function(row) {\n      var binary_id, doc, _ref, _ref1;\n      doc = row.doc;\n      if (doc.docType.toLowerCase() === 'file') {\n        if (binary_id = (_ref = doc.binary) != null ? (_ref1 = _ref.file) != null ? _ref1.id : void 0 : void 0) {\n          doc.incache = app.replicator.fileInFileSystem(doc);\n          doc.version = app.replicator.fileVersion(doc);\n        }\n      } else if (doc.docType.toLowerCase() === 'folder') {\n        doc.incache = false;\n      }\n      return doc;\n    });\n  };\n\n  FileAndFolderCollection.prototype.slowReset = function(results, callback) {\n    var i, models, nonBlockingAdd;\n    models = this._rowsToModels(results);\n    this.reset(models.slice(0, 10));\n    if (models.length < 10) {\n      return callback(null);\n    }\n    i = 0;\n    return (nonBlockingAdd = (function(_this) {\n      return function() {\n        if (i * 10 > models.length) {\n          _this.nextAdd = null;\n          return callback(null);\n        }\n        i++;\n        _this.add(models.slice(i * 10, (i + 1) * 10));\n        return _this.nextAdd = setTimeout(nonBlockingAdd, 10);\n      };\n    })(this))();\n  };\n\n  FileAndFolderCollection.prototype.remove = function() {\n    FileAndFolderCollection.__super__.remove.apply(this, arguments);\n    return this.clearTimeout(this.nextAdd);\n  };\n\n  FileAndFolderCollection.prototype.cancelFetchAdditional = function() {\n    return this.cancelled = true;\n  };\n\n  FileAndFolderCollection.prototype.fetchAdditional = function() {\n    var toBeCached;\n    FileAndFolderCollection.cache = {};\n    toBeCached = this.filter(function(model) {\n      var _ref;\n      return ((_ref = model.get('docType')) != null ? _ref.toLowerCase() : void 0) === 'folder';\n    });\n    return async.eachSeries(toBeCached, (function(_this) {\n      return function(folder, cb) {\n        var path;\n        if (_this.cancelled) {\n          return cb(new Error('cancelled'));\n        }\n        path = folder.wholePath();\n        return _this._fetch(path, function(err, items) {\n          if (this.cancelled) {\n            return cb(new Error('cancelled'));\n          }\n          if (!err) {\n            FileAndFolderCollection.cache[path] = items;\n          }\n          return app.replicator.folderInFileSystem(path, function(err, incache) {\n            if (this.cancelled) {\n              return cb(new Error('cancelled'));\n            }\n            if (err) {\n              log.error(err);\n            }\n            folder.set('incache', incache);\n            return setImmediate(cb);\n          });\n        });\n      };\n    })(this), (function(_this) {\n      return function(err) {\n        var path;\n        if (_this.cancelled) {\n          return;\n        }\n        if (err) {\n          log.error(err);\n        }\n        path = (_this.path || '').split('/').slice(0, -1).join('/');\n        return _this._fetch(path, function(err, items) {\n          if (_this.cancelled) {\n            return;\n          }\n          if (!err) {\n            FileAndFolderCollection.cache[path] = items;\n          }\n          return _this.trigger('fullsync');\n        });\n      };\n    })(this));\n  };\n\n  return FileAndFolderCollection;\n\n})(Backbone.Collection);\n","var app;\n\napp = require('application');\n\ndocument.addEventListener('deviceready', function() {\n  return app.initialize();\n});\n","var BaseView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = BaseView = (function(_super) {\n  __extends(BaseView, _super);\n\n  function BaseView() {\n    return BaseView.__super__.constructor.apply(this, arguments);\n  }\n\n  BaseView.prototype.template = function() {};\n\n  BaseView.prototype.initialize = function() {};\n\n  BaseView.prototype.getRenderData = function() {\n    var _ref;\n    return {\n      model: (_ref = this.model) != null ? _ref.toJSON() : void 0\n    };\n  };\n\n  BaseView.prototype.render = function() {\n    this.beforeRender();\n    this.$el.html(this.template(this.getRenderData()));\n    this.afterRender();\n    return this;\n  };\n\n  BaseView.prototype.beforeRender = function() {};\n\n  BaseView.prototype.afterRender = function() {};\n\n  BaseView.prototype.destroy = function() {\n    this.undelegateEvents();\n    this.$el.removeData().unbind();\n    this.remove();\n    return Backbone.View.prototype.remove.call(this);\n  };\n\n  return BaseView;\n\n})(Backbone.View);\n","var b64, b64_enc, basic;\n\nb64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\nb64_enc = function(data) {\n  var ac, bits, h1, h2, h3, h4, i, o1, o2, o3, out;\n  if (!data) {\n    return data;\n  }\n  i = 0;\n  ac = 0;\n  out = [];\n  while (i < data.length) {\n    o1 = data.charCodeAt(i++);\n    o2 = data.charCodeAt(i++);\n    o3 = data.charCodeAt(i++);\n    bits = o1 << 16 | o2 << 8 | o3;\n    h1 = bits >> 18 & 0x3f;\n    h2 = bits >> 12 & 0x3f;\n    h3 = bits >> 6 & 0x3f;\n    h4 = bits & 0x3f;\n    out[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n  }\n  out = out.join('');\n  switch (data.length % 3) {\n    case 1:\n      out = out.slice(0, -2) + '==';\n      break;\n    case 2:\n      out = out.slice(0, -1) + '=';\n  }\n  return out;\n};\n\nmodule.exports = basic = function(auth) {\n  return 'Basic ' + b64_enc(auth.username + ':' + auth.password);\n};\n","var battery, callbackWaiting, callbacks, checkReadyForSync, log, timeout;\n\nlog = require('/lib/persistent_log')({\n  prefix: \"device status\",\n  date: true\n});\n\ncallbacks = [];\n\nbattery = null;\n\ntimeout = true;\n\ncallbackWaiting = function(err, ready, msg) {\n  var callback, _i, _len;\n  for (_i = 0, _len = callbacks.length; _i < _len; _i++) {\n    callback = callbacks[_i];\n    callback(err, ready, msg);\n  }\n  return callbacks = [];\n};\n\nmodule.exports.initialize = function() {\n  timeout = true;\n  log.info(\"initialize device status.\");\n  return window.addEventListener('batterystatus', (function(_this) {\n    return function(newStatus) {\n      timeout = false;\n      battery = newStatus;\n      return checkReadyForSync();\n    };\n  })(this));\n};\n\nmodule.exports.checkReadyForSync = checkReadyForSync = function(callback) {\n  if (callback != null) {\n    callbacks.push(callback);\n  }\n  if (battery == null) {\n    setTimeout((function(_this) {\n      return function() {\n        if (timeout) {\n          timeout = false;\n          return callbackWaiting(new Error(\"No battery informations\"));\n        }\n      };\n    })(this), 4 * 1000);\n    return;\n  }\n  if (!(battery.level > 20 || battery.isPlugged)) {\n    log.info(\"NOT ready on battery low.\");\n    return callbackWaiting(null, false, 'no battery');\n  }\n  if (app.replicator.config.get('syncOnWifi') && (!(navigator.connection.type === Connection.WIFI))) {\n    log.info(\"NOT ready on no wifi.\");\n    return callbackWaiting(null, false, 'no wifi');\n  }\n  log.info(\"ready to sync.\");\n  return callbackWaiting(null, true);\n};\n","var LOG_SIZE, Logger, colors, levelColors,\n  __slice = [].slice;\n\nmodule.exports = function(options) {\n  return new Logger(options);\n};\n\nLOG_SIZE = 500;\n\ncolors = {\n  blue: ['\\x1B[34m', '\\x1B[39m'],\n  cyan: ['\\x1B[36m', '\\x1B[39m'],\n  green: ['\\x1B[32m', '\\x1B[39m'],\n  magenta: ['\\x1B[36m', '\\x1B[39m'],\n  red: ['\\x1B[31m', '\\x1B[39m'],\n  yellow: ['\\x1B[33m', '\\x1B[39m']\n};\n\nlevelColors = {\n  error: colors.red,\n  debug: colors.green,\n  warn: colors.yellow,\n  info: colors.blue\n};\n\nLogger = (function() {\n  function Logger(options) {\n    this.options = options;\n    if (this.options == null) {\n      this.options = {};\n    }\n    if ('processusTag' in this.options) {\n      Logger.processusTag = this.options.processusTag;\n    }\n    if (typeof localStorage === \"undefined\" || localStorage === null) {\n      this.noLog = true;\n    }\n  }\n\n  Logger.prototype.stringify = function(text) {\n    var err;\n    if (text instanceof Error) {\n      err = text;\n      text = err.message;\n      if (err.stack != null) {\n        text += \"\\n\" + err.stack;\n      }\n    } else if (text instanceof Object) {\n      text = JSON.stringify(text);\n    }\n    return text;\n  };\n\n  Logger.prototype.format = function(level, texts) {\n    var date, text;\n    text = ((function() {\n      var _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = texts.length; _i < _len; _i++) {\n        text = texts[_i];\n        _results.push(this.stringify(text));\n      }\n      return _results;\n    }).call(this)).join(\" \");\n    if (this.options.prefix != null) {\n      text = \"\" + this.options.prefix + \" | \" + text;\n    }\n    if (level) {\n      text = \"\" + level + \" - \" + text;\n    }\n    if (Logger.processusTag) {\n      text = \"\" + Logger.processusTag + \"> \" + text;\n    }\n    if (this.options.date) {\n      date = new Date().toISOString();\n      text = \"[\" + date + \"] \" + text;\n    }\n    return text;\n  };\n\n  Logger.prototype.info = function() {\n    var text, texts;\n    texts = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n    if (this.noLog) {\n      return;\n    }\n    text = this.format('info', texts);\n    this.persist(text);\n    return console.info(text);\n  };\n\n  Logger.prototype.warn = function() {\n    var text, texts;\n    texts = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n    if (this.noLog) {\n      return;\n    }\n    text = this.format('warn', texts);\n    this.persist(text);\n    return console.warn(text);\n  };\n\n  Logger.prototype.error = function() {\n    var text, texts;\n    texts = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n    if (this.noLog) {\n      return;\n    }\n    text = this.format('error', texts);\n    this.persist(text);\n    return console.error(text);\n  };\n\n  Logger.prototype.debug = function() {\n    var text, texts;\n    texts = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n    if (this.noLog) {\n      return;\n    }\n    text = this.format('debug', texts);\n    this.persist(text);\n    return console.info(text);\n  };\n\n  Logger.prototype.raw = function() {\n    var texts;\n    texts = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n    if (this.noLog) {\n      return;\n    }\n    return console.log.apply(console, texts);\n  };\n\n  Logger.prototype.lineBreak = function(text) {\n    if (this.noLog) {\n      return;\n    }\n    text = Array(80).join(\"*\");\n    this.raw(text);\n    return window.logTrace.push(text);\n  };\n\n  Logger.prototype.persist = function(text) {\n    var logIndex;\n    logIndex = +localStorage.getItem(\"log_index\");\n    logIndex = (logIndex + 1) % LOG_SIZE;\n    localStorage.setItem(\"log_\" + logIndex, text);\n    return localStorage.setItem(\"log_index\", '' + logIndex);\n  };\n\n  Logger.prototype.getTraces = function() {\n    var i, log, logIndex, traces;\n    logIndex = +localStorage.getItem(\"log_index\");\n    i = (logIndex + 1) % LOG_SIZE;\n    traces = [];\n    while (i !== logIndex) {\n      log = localStorage.getItem(\"log_\" + i);\n      if (log) {\n        traces.push(log);\n      }\n      i = (i + 1) % LOG_SIZE;\n    }\n    return traces;\n  };\n\n  return Logger;\n\n})();\n","// Browser Request\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nvar XHR = XMLHttpRequest\nif (!XHR) throw new Error('missing XMLHttpRequest')\nrequest.log = {\n  'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\n}\n\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\n\n//\n// request\n//\n\nfunction request(options, callback) {\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\n  if(typeof callback !== 'function')\n    throw new Error('Bad callback given: ' + callback)\n\n  if(!options)\n    throw new Error('No options given')\n\n  var options_onResponse = options.onResponse; // Save this for later.\n\n  if(typeof options === 'string')\n    options = {'uri':options};\n  else\n    options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\n\n  options.onResponse = options_onResponse // And put it back.\n\n  if (options.verbose) request.log = getLogger();\n\n  if(options.url) {\n    options.uri = options.url;\n    delete options.url;\n  }\n\n  if(!options.uri && options.uri !== \"\")\n    throw new Error(\"options.uri is a required argument\");\n\n  if(typeof options.uri != \"string\")\n    throw new Error(\"options.uri must be a string\");\n\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\n  for (var i = 0; i < unsupported_options.length; i++)\n    if(options[ unsupported_options[i] ])\n      throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\n\n  options.callback = callback\n  options.method = options.method || 'GET';\n  options.headers = options.headers || {};\n  options.body    = options.body || null\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT\n\n  if(options.headers.host)\n    throw new Error(\"Options.headers.host is not supported\");\n\n  if(options.json) {\n    options.headers.accept = options.headers.accept || 'application/json'\n    if(options.method !== 'GET')\n      options.headers['content-type'] = 'application/json'\n\n    if(typeof options.json !== 'boolean')\n      options.body = JSON.stringify(options.json)\n    else if(typeof options.body !== 'string')\n      options.body = JSON.stringify(options.body)\n  }\n\n  //BEGIN QS Hack\n  var serialize = function(obj) {\n    var str = [];\n    for(var p in obj)\n      if (obj.hasOwnProperty(p)) {\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n      }\n    return str.join(\"&\");\n  }\n\n  if(options.qs){\n    var qs = (typeof options.qs == 'string')? options.qs : serialize(options.qs);\n    if(options.uri.indexOf('?') !== -1){ //no get params\n        options.uri = options.uri+'&'+qs;\n    }else{ //existing get params\n        options.uri = options.uri+'?'+qs;\n    }\n  }\n  //END QS Hack\n\n  //BEGIN FORM Hack\n  var multipart = function(obj) {\n    //todo: support file type (useful?)\n    var result = {};\n    result.boundry = '-------------------------------'+Math.floor(Math.random()*1000000000);\n    var lines = [];\n    for(var p in obj){\n        if (obj.hasOwnProperty(p)) {\n            lines.push(\n                '--'+result.boundry+\"\\n\"+\n                'Content-Disposition: form-data; name=\"'+p+'\"'+\"\\n\"+\n                \"\\n\"+\n                obj[p]+\"\\n\"\n            );\n        }\n    }\n    lines.push( '--'+result.boundry+'--' );\n    result.body = lines.join('');\n    result.length = result.body.length;\n    result.type = 'multipart/form-data; boundary='+result.boundry;\n    return result;\n  }\n\n  if(options.form){\n    if(typeof options.form == 'string') throw('form name unsupported');\n    if(options.method === 'POST'){\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\n        options.headers['content-type'] = encoding;\n        switch(encoding){\n            case 'application/x-www-form-urlencoded':\n                options.body = serialize(options.form).replace(/%20/g, \"+\");\n                break;\n            case 'multipart/form-data':\n                var multi = multipart(options.form);\n                //options.headers['content-length'] = multi.length;\n                options.body = multi.body;\n                options.headers['content-type'] = multi.type;\n                break;\n            default : throw new Error('unsupported encoding:'+encoding);\n        }\n    }\n  }\n  //END FORM Hack\n\n  // If onResponse is boolean true, call back immediately when the response is known,\n  // not when the full request is complete.\n  options.onResponse = options.onResponse || noop\n  if(options.onResponse === true) {\n    options.onResponse = callback\n    options.callback = noop\n  }\n\n  // XXX Browsers do not like this.\n  //if(options.body)\n  //  options.headers['content-length'] = options.body.length;\n\n  // HTTP basic authentication\n  if(!options.headers.authorization && options.auth)\n    options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\n\n  return run_xhr(options)\n}\n\nvar req_seq = 0\nfunction run_xhr(options) {\n  var xhr = new XHR\n    , timed_out = false\n    , is_cors = is_crossDomain(options.uri)\n    , supports_cors = ('withCredentials' in xhr)\n\n  req_seq += 1\n  xhr.seq_id = req_seq\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\n  xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\n\n  if(is_cors && !supports_cors) {\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\n    cors_err.cors = 'unsupported'\n    return options.callback(cors_err, xhr)\n  }\n\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout)\n  function too_late() {\n    timed_out = true\n    var er = new Error('ETIMEDOUT')\n    er.code = 'ETIMEDOUT'\n    er.duration = options.timeout\n\n    request.log.error('Timeout', { 'id':xhr._id, 'milliseconds':options.timeout })\n    return options.callback(er, xhr)\n  }\n\n  // Some states can be skipped over, so remember what is still incomplete.\n  var did = {'response':false, 'loading':false, 'end':false}\n\n  xhr.onreadystatechange = on_state_change\n  xhr.open(options.method, options.uri, true) // asynchronous\n  if(is_cors)\n    xhr.withCredentials = !! options.withCredentials\n  xhr.send(options.body)\n  return xhr\n\n  function on_state_change(event) {\n    if(timed_out)\n      return request.log.debug('Ignoring timed out state change', {'state':xhr.readyState, 'id':xhr.id})\n\n    request.log.debug('State change', {'state':xhr.readyState, 'id':xhr.id, 'timed_out':timed_out})\n\n    if(xhr.readyState === XHR.OPENED) {\n      request.log.debug('Request started', {'id':xhr.id})\n      for (var key in options.headers)\n        xhr.setRequestHeader(key, options.headers[key])\n    }\n\n    else if(xhr.readyState === XHR.HEADERS_RECEIVED)\n      on_response()\n\n    else if(xhr.readyState === XHR.LOADING) {\n      on_response()\n      on_loading()\n    }\n\n    else if(xhr.readyState === XHR.DONE) {\n      on_response()\n      on_loading()\n      on_end()\n    }\n  }\n\n  function on_response() {\n    if(did.response)\n      return\n\n    did.response = true\n    request.log.debug('Got response', {'id':xhr.id, 'status':xhr.status})\n    clearTimeout(xhr.timeoutTimer)\n    xhr.statusCode = xhr.status // Node request compatibility\n\n    // Detect failed CORS requests.\n    if(is_cors && xhr.statusCode == 0) {\n      var cors_err = new Error('CORS request rejected: ' + options.uri)\n      cors_err.cors = 'rejected'\n\n      // Do not process this request further.\n      did.loading = true\n      did.end = true\n\n      return options.callback(cors_err, xhr)\n    }\n\n    options.onResponse(null, xhr)\n  }\n\n  function on_loading() {\n    if(did.loading)\n      return\n\n    did.loading = true\n    request.log.debug('Response body loading', {'id':xhr.id})\n    // TODO: Maybe simulate \"data\" events by watching xhr.responseText\n  }\n\n  function on_end() {\n    if(did.end)\n      return\n\n    did.end = true\n    request.log.debug('Request done', {'id':xhr.id})\n\n    xhr.body = xhr.responseText\n    if(options.json) {\n      try        { xhr.body = JSON.parse(xhr.responseText) }\n      catch (er) { return options.callback(er, xhr)        }\n    }\n\n    options.callback(null, xhr, xhr.body)\n  }\n\n} // request\n\nrequest.withCredentials = false;\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\n\n//\n// defaults\n//\n\nrequest.defaults = function(options, requester) {\n  var def = function (method) {\n    var d = function (params, callback) {\n      if(typeof params === 'string')\n        params = {'uri': params};\n      else {\n        params = JSON.parse(JSON.stringify(params));\n      }\n      for (var i in options) {\n        if (params[i] === undefined) params[i] = options[i]\n      }\n      return method(params, callback)\n    }\n    return d\n  }\n  var de = def(request)\n  de.get = def(request.get)\n  de.post = def(request.post)\n  de.put = def(request.put)\n  de.head = def(request.head)\n  return de\n}\n\n//\n// HTTP method shortcuts\n//\n\nvar shortcuts = [ 'get', 'put', 'post', 'head' ];\nshortcuts.forEach(function(shortcut) {\n  var method = shortcut.toUpperCase();\n  var func   = shortcut.toLowerCase();\n\n  request[func] = function(opts) {\n    if(typeof opts === 'string')\n      opts = {'method':method, 'uri':opts};\n    else {\n      opts = JSON.parse(JSON.stringify(opts));\n      opts.method = method;\n    }\n\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\n    return request.apply(this, args);\n  }\n})\n\n//\n// CouchDB shortcut\n//\n\nrequest.couch = function(options, callback) {\n  if(typeof options === 'string')\n    options = {'uri':options}\n\n  // Just use the request API to do JSON.\n  options.json = true\n  if(options.body)\n    options.json = options.body\n  delete options.body\n\n  callback = callback || noop\n\n  var xhr = request(options, couch_handler)\n  return xhr\n\n  function couch_handler(er, resp, body) {\n    if(er)\n      return callback(er, resp, body)\n\n    if((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\n      // The body is a Couch JSON object indicating the error.\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error || body.error))\n      for (var key in body)\n        er[key] = body[key]\n      return callback(er, resp, body);\n    }\n\n    return callback(er, resp, body);\n  }\n}\n\n//\n// Utility\n//\n\nfunction noop() {}\n\nfunction getLogger() {\n  var logger = {}\n    , levels = ['trace', 'debug', 'info', 'warn', 'error']\n    , level, i\n\n  for(i = 0; i < levels.length; i++) {\n    level = levels[i]\n\n    logger[level] = noop\n    if(typeof console !== 'undefined' && console && console[level])\n      logger[level] = formatted(console, level)\n  }\n\n  return logger\n}\n\nfunction formatted(obj, method) {\n  return formatted_logger\n\n  function formatted_logger(str, context) {\n    if(typeof context === 'object')\n      str += ' ' + JSON.stringify(context)\n\n    return obj[method].call(obj, str)\n  }\n}\n\n// Return whether a URL is a cross-domain request.\nfunction is_crossDomain(url) {\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\n\n  // jQuery #8138, IE may throw an exception when accessing\n  // a field from window.location if document.domain has been set\n  var ajaxLocation\n  try { ajaxLocation = location.href }\n  catch (e) {\n    // Use the href attribute of an A element since IE will modify it given document.location\n    ajaxLocation = document.createElement( \"a\" );\n    ajaxLocation.href = \"\";\n    ajaxLocation = ajaxLocation.href;\n  }\n\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\n    , parts = rurl.exec(url.toLowerCase() )\n\n  var result = !!(\n    parts &&\n    (  parts[1] != ajaxLocParts[1]\n    || parts[2] != ajaxLocParts[2]\n    || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\n    )\n  )\n\n  //console.debug('is_crossDomain('+url+') -> ' + result)\n  return result\n}\n\n// MIT License from http://phpjs.org/functions/base64_encode:358\nfunction b64_enc (data) {\n    // Encodes string using MIME base64 algorithm\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    // assume utf8 data\n    // data = this.utf8_encode(data+'');\n    // Fix cozy 2015-08-25 : escape to UTF8\n    data = unescape(encodeURIComponent(data));\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1<<16 | o2<<8 | o3;\n\n        h1 = bits>>18 & 0x3f;\n        h2 = bits>>12 & 0x3f;\n        h3 = bits>>6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n        break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n}\nmodule.exports = request;\n","window.setImmediate = window.setImmediate || function(callback) {\n  return setTimeout(callback, 1);\n};\n","var BaseView, ViewCollection,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('lib/base_view');\n\nmodule.exports = ViewCollection = (function(_super) {\n  __extends(ViewCollection, _super);\n\n  function ViewCollection() {\n    this.removeItem = __bind(this.removeItem, this);\n    this.addItem = __bind(this.addItem, this);\n    return ViewCollection.__super__.constructor.apply(this, arguments);\n  }\n\n  ViewCollection.prototype.itemview = null;\n\n  ViewCollection.prototype.views = {};\n\n  ViewCollection.prototype.template = function() {\n    return '';\n  };\n\n  ViewCollection.prototype.itemViewOptions = function() {};\n\n  ViewCollection.prototype.collectionEl = null;\n\n  ViewCollection.prototype.onChange = function() {\n    return this.$el.toggleClass('empty', _.size(this.views) === 0);\n  };\n\n  ViewCollection.prototype.appendView = function(view) {\n    var idx, modelAfter, viewAfter;\n    idx = this.collection.indexOf(view.model);\n    modelAfter = this.collection.at(idx + 1);\n    if (!modelAfter) {\n      return this.$collectionEl.append(view.el);\n    }\n    viewAfter = this.views[modelAfter.cid];\n    if (viewAfter) {\n      return viewAfter.$el.before(view.el);\n    } else {\n      return this.$collectionEl.append(view.el);\n    }\n  };\n\n  ViewCollection.prototype.initialize = function() {\n    ViewCollection.__super__.initialize.apply(this, arguments);\n    this.views = {};\n    this.listenTo(this.collection, \"reset\", this.onReset);\n    this.listenTo(this.collection, \"add\", this.addItem);\n    this.listenTo(this.collection, \"remove\", this.removeItem);\n    if (this.collectionEl == null) {\n      this.collectionEl = this.el;\n      return this.$collectionEl = this.$el;\n    }\n  };\n\n  ViewCollection.prototype.render = function() {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      view.$el.detach();\n    }\n    return ViewCollection.__super__.render.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.afterRender = function() {\n    var id, view, _ref;\n    if (!this.$collectionEl) {\n      this.$collectionEl = this.$(this.collectionEl);\n    }\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      this.appendView(view);\n    }\n    this.onReset(this.collection);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.remove = function() {\n    this.onReset([]);\n    return ViewCollection.__super__.remove.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.onReset = function(newcollection) {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      view.remove();\n    }\n    return newcollection.forEach(this.addItem);\n  };\n\n  ViewCollection.prototype.addItem = function(model) {\n    var options, view;\n    options = _.extend({}, {\n      model: model\n    }, this.itemViewOptions(model));\n    view = new this.itemview(options);\n    this.views[model.cid] = view.render();\n    this.appendView(view);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.removeItem = function(model) {\n    this.views[model.cid].remove();\n    delete this.views[model.cid];\n    return this.onChange(this.views);\n  };\n\n  return ViewCollection;\n\n})(BaseView);\n","module.exports = {\n  \"app name\": \"Cozy mobile\",\n  \"cozy url\": \"Cozy's domain\",\n  \"cozy password\": \"Cozy's password\",\n  \"name device\": \"Name this device\",\n  \"device name\": \"Device name\",\n  \"search\": \"search\",\n  \"config\": \"Config\",\n  \"never\": \"Never\",\n  \"phone2cozy title\": \"Phone to Cozy backup\",\n  \"contacts sync label\": \"Sync contacts\",\n  \"images sync label\": \"Backup images\",\n  \"wifi sync label\": \"Backup on Wifi only\",\n  \"cozy notifications sync label\": \"Sync Cozy notifications\",\n  \"home\": \"Home\",\n  \"files\": \"Files\",\n  \"about\": \"About\",\n  \"last backup\": \"Last was :\",\n  \"reset title\": \"Reset\",\n  \"reset action\": \"Reset\",\n  \"retry synchro\": \"Sync\",\n  \"synchro warning\": \"Launch a replication from the beginning. It may take a while.\",\n  \"reset warning\": \"Erase all Cozy-generated data on your phone.\",\n  \"support\": \"Support\",\n  \"send log\": \"Send Log\",\n  \"send log info\": \"Send an email with application log to help us improve its quality and stability.\",\n  \"pull to sync\": \"Pull to sync\",\n  \"syncing\": \"Syncing\",\n  \"contacts_sync\": \"Syncing contacts\",\n  \"contacts_sync_to_pouch\": \"Syncing contacts\",\n  \"contacts_sync_to_cozy\": \"Syncing contacts\",\n  \"contacts_sync_to_phone\": \"Syncing contacts\",\n  \"pictures_sync\": \"Syncing pictures\",\n  \"cache_sync\": \"Updating cache\",\n  \"destroying database\": \"Destroying database\",\n  \"synchronized with\": \"Synchronized with \",\n  \"this folder is empty\": \"This folder is empty.\",\n  \"no results\": \"No results\",\n  \"loading\": \"Loading\",\n  \"remove local\": \"Remove local\",\n  \"download\": \"Download\",\n  \"sync\": \"Refresh\",\n  \"backup\": \"Backup\",\n  \"save\": \"Save\",\n  \"done\": \"Done\",\n  \"photos\": \"Photos from devices\",\n  \"confirm message\": \"Are you sure?\",\n  \"confirm exit message\": \"Do you want to Exit?\",\n  \"replication complete\": \"Replication complete\",\n  \"next\": \"Next\",\n  \"back\": \"Back\",\n  \"connection failure\": \"Connection failure\",\n  \"setup 1/3\": \"Setup 1/3\",\n  \"cozy welcome\": \"Welcome!\",\n  \"cozy welcome message\": \"Cozy App enables you to: <ul><li>View your Files</li><li>Synchronize your Contacts</li><li>Backup your Photos</li></ul>\",\n  \"cozy welcome no account\": \"If you don't already have a Cozy instance, visit <a target='_system' href='http://cozy.io/en/'>cozy.io</a> for more details.\",\n  \"url placeholder\": \"Your Cozy Address\",\n  \"password placeholder\": \"Your Password\",\n  \"authenticating...\": \"Authenticating...\",\n  \"setup 2/3\": \"Setup 2/3\",\n  \"device name explanation\": \"Choose a display name for this device so you can easily manage it.\",\n  \"device name placeholder\": \"my-phone\",\n  \"registering...\": \"Registering...\",\n  \"setup 3/3\": \"Setup 3/3\",\n  \"setup end\": \"End of setting\",\n  \"message step 0\": \"Step 1/5: Files synchronization.\",\n  \"message step 1\": \"Step 2/5: Folders synchronization.\",\n  \"message step 2\": \"Step 3/5: Notifications synchronization.\",\n  \"message step 3\": \"Step 4/5: Contacts synchronization.\",\n  \"message step 4\": \"Step 5/5: Documents preparation.\",\n  \"wait message device\": \"Device configuration...\",\n  \"ready message\": \"The application is ready to be used!\",\n  \"waiting...\": \"Waiting...\",\n  \"filesystem bug error\": \"File system bug error. Try to restart your phone.\",\n  \"end\": \"End\",\n  \"all fields are required\": \"All fields are required\",\n  \"cozy need patch\": \"Cozy need patch\",\n  \"wrong password\": \"Incorrect password\",\n  \"device name already exist\": \"Device name already exist\",\n  \"An error happened (UNKNOWN)\": \"An error occured.\",\n  \"An error happened (NOT FOUND)\": \"An error occured (not found).\",\n  \"An error happened (INVALID URL)\": \"An error occured (invalid url).\",\n  \"This file isnt available offline\": \"This file isn't available offline.\",\n  \"ABORTED\": \"The procedure was aborted.\",\n  \"photo folder not replicated yet\": \"Initialization not finished yet.\",\n  \"Not Found\": \"Error while initializing. Did you install the Files application in your Cozy ?\",\n  \"connexion error\": \"We failed to connect to your cozy. Please check that your device is connected to the internet, the address of your cozy is spelled correctly and your cozy is running. If you are an advanced user with a self hosted cozy, refer to the <a href='http://cozy.io/en/mobile/files.html#note-about-self-signed-certificates' target='_system'>doc to handle self-signed certificates</a>.\",\n  \"no images in DCIM\": \"Backup images : no image found in DCIM dir.\",\n  \"Document update conflict\": \"Update conflict in database, you could try to restart the app to fix it.\",\n  \"Database not initialized. Confirm initialize\": \"Initialization didn't finish correctly. Retry ?\",\n  \"no activity found\": \"No application on phone for this kind of file.\",\n  \"not enough space\": \"Not enough disk space, remove some files from cache.\",\n  \"no battery\": \"Not enough battery, Sync cancelled.\",\n  \"no wifi\": \"No Wifi, Sync cancelled.\",\n  \"no connection\": \"No connection, Sync cancelled.\"\n};\n","module.exports = {\n  \"app name\": \"Cozy movil\",\n  \"cozy url\": \"Direccin de Cozy\",\n  \"cozy password\": \"Contrasea\",\n  \"name device\": \"Dar un nombre al perifrico\",\n  \"device name\": \"Nombre del perifrico\",\n  \"search\": \"buscar\",\n  \"config\": \"Configuracin\",\n  \"never\": \"Nunca\",\n  \"phone2cozy title\": \"Hacer copia de seguridad del contenido del telfono\",\n  \"contacts sync label\": \"Hacer copia de seguridad de los contactos\",\n  \"images sync label\": \"Hacer copia de seguridad de las imgenes del telfono\",\n  \"wifi sync label\": \"Hacer copia de seguridad solamente si Wifi\",\n  \"cozy notifications sync label\": \"Sincronizar las notificaciones Cozy\",\n  \"home\": \"Inicio\",\n  \"about\": \"Acerca de\",\n  \"last backup\": \"ltima copia de seguridad:\",\n  \"reset title\": \"Reinicializar\",\n  \"reset action\": \"Reinicializar\",\n  \"retry synchro\": \"Sincronizar\",\n  \"synchro warning\": \"Esto relanzar una sincronizacin desde el comienzo. Puede tomar mucho tiempo.\",\n  \"reset warning\": \"Esto suprimir todos los datos cozy de su telfono.\",\n  \"pull to sync\": \"Arrastrar para sincronizar\",\n  \"syncing\": \"En curso de sincronizacin\",\n  \"contacts_sync\": \"Sincronizacin de los contactos\",\n  \"contacts_sync_to_pouch\": \"Sincronizacin de los contactos -> Cozy\",\n  \"contacts_sync_to_cozy\": \"Sincronizacin de los contactos -> Cozy ...\",\n  \"contacts_sync_to_phone\": \"Sincronizacin de los contactos <- Cozy\",\n  \"pictures_sync\": \"Sincronizacin de las imgenes\",\n  \"cache_update\": \"Actualizacin de la cach\",\n  \"destroying database\": \"Destruccin de la base de datos\",\n  \"synchronized with\": \"Sincronizado con\",\n  \"this folder is empty\": \"Esta carpeta est vaca\",\n  \"no results\": \"No hay resultados\",\n  \"loading\": \"Cargando\",\n  \"remove local\": \"Suprimir del telfono\",\n  \"download\": \"Cargar\",\n  \"sync\": \"Recargar\",\n  \"backup\": \"Copia de seguridad\",\n  \"save\": \"Guardar\",\n  \"done\": \"Hecho\",\n  \"photos\": \"Fotos desde los perifricos\",\n  \"confirm message\": \"Est usted seguro(a)?\",\n  \"confirm exit message\": \"Quiere usted salir de la aplicacin?\",\n  \"replication complete\": \"Reproduccin terminada\",\n  \"no activity found\": \"Ninguna aplicacin se ha encontrado en el telfono para este tipo de archivos.\",\n  \"not enough space\": \"No hay suficiente espacio disco en su telfono.\",\n  \"no battery\": \"La copia de seguridad no se har ya que su telfono no tiene suficiente batera.\",\n  \"no wifi\": \"La copia de seguridad no se har porque no hay conexin Wifi.\",\n  \"no connection\": \"La copia de seguridad no se har porque usted no est conectado.\",\n  \"next\": \"Siguiente\",\n  \"back\": \"Atrs\",\n  \"connection failure\": \"Falla en la conexin\",\n  \"setup 1/3\": \"Configuracin 1/3\",\n  \"url placeholder\": \"Su cozy\",\n  \"password placeholder\": \"Su contrasea\",\n  \"authenticating...\": \"Verificacin de los identificadores...\",\n  \"setup 2/3\": \"Configuracin 2/3\",\n  \"device name explanation\": \"Escoger un nombre de uso de este perifrico para poderlo administrar desde su Cozy.\",\n  \"device name placeholder\": \"mi-telfono\",\n  \"registering...\": \"Registrando...\",\n  \"setup 3/3\": \"Configuracin 3/3\",\n  \"setup end\": \"Fin de la configuracin\",\n  \"message step 0\": \"Etapa 1/5: Sincronizacin de los archivos.\",\n  \"message step 1\": \"Etapa 2/5: Sincronizacin de las carpetas.\",\n  \"message step 2\": \"Etapa 3/5: Sincronizacin de las notificaciones.\",\n  \"message step 3\": \"Etapa 4/5: Sincronizacin de los contactos.\",\n  \"message step 4\": \"Etapa 5/5: Preparacin de los documentos.\",\n  \"wait message device\": \"Configuracin del perifrico...\",\n  \"ready message\": \"La aplicacin est lista para su uso!\",\n  \"waiting...\": \"En espera...\",\n  \"filesystem bug error\": \"Error en el sistema de archivos. Tratar de reinicializar su telfono.\",\n  \"end\": \"Fin\",\n  \"all fields are required\": \"Todas las casillas son obligatorias\",\n  \"cozy need patch\": \"Cozy necesita un correctivo\",\n  \"wrong password\": \"Contrasea incorrecta\",\n  \"device name already exist\": \"Ese nombre de perifrico ya existe\",\n  \"An error happened (UNKNOWN)\": \"Un error ha ocurrido\",\n  \"An error happened (NOT FOUND)\": \"Un error ha ocurrido (no identificado)\",\n  \"An error happened (INVALID URL)\": \"Un error ha ocurrido (url invlida)\",\n  \"This file isnt available offline\": \"Este archivo no est disponible fuera de lnea.\",\n  \"ABORTED\": \"El procedimiento se ha interrumpido.\",\n  \"photo folder not replicated yet\": \"La inicializacin an no ha terminado.\",\n  \"Not Found\": \"Error en la inicializacin. Ha usted instalado la aplicacin Archivos en su Cozy?\",\n  \"connexion error\": \"La conexin a su cozy ha fallado. Revisar que su perifrico est conectado a internet, que la direccin de su cozy est bien escrita y si su cozy funciona. Para los usuarios avezados con cozy en sus propios servidores, consultar la <a href='http://cozy.io/en/mobile/files.html#note-about-self-signed-certificates' target='_system'>documentacin sobre los certificados auto-firmados </a>\",\n  \"no images in DCIM\": \"Copia de seguridad de imgenes: no se ha encontrado ninguna imagen en el directorio DCIM.\",\n  \"Document update conflict\": \"Conflicto durante una operacin de base de datos. Reinicie la aplicacin para arreglarlo.\"\n};\n","module.exports = {\n  \"app name\": \"Cozy mobile\",\n  \"cozy url\": \"Adresse Cozy\",\n  \"cozy password\": \"Mot de passe\",\n  \"device name\": \"Nom de l'appareil\",\n  \"name device\": \"Nom de l'appareil\",\n  \"search\": \"Recherche\",\n  \"config\": \"Configuration\",\n  \"never\": \"Jamais\",\n  \"phone2cozy title\": \"Sauvegarde du tlphone\",\n  \"contacts sync label\": \"Synchronisation des contacts\",\n  \"images sync label\": \"Sauvegarde des images du tlphone\",\n  \"wifi sync label\": \"Sauvegarde uniquement en Wifi\",\n  \"cozy notifications sync label\": \"Synchroniser les notifications Cozy\",\n  \"home\": \"Accueil\",\n  \"files\": \"Fichiers\",\n  \"about\": \" propos\",\n  \"last backup\": \"Derniere sauvegarde:\",\n  \"reset title\": \"Remise  zro\",\n  \"reset action\": \"Remise  Zro\",\n  \"retry synchro\": \"Synchroniser\",\n  \"synchro warning\": \"Relancer une synchronisation depuis le dbut. Cela peut prendre du temps.\",\n  \"reset warning\": \"Supprimer toutes les donnes Cozy sur votre mobile.\",\n  \"support\": \"Support\",\n  \"send log\": \"Envoyer Journal\",\n  \"send log info\": \"Envoyer un email avec le journal de l'application afin de nous aider  amliorer sa qualit et sa fiabilit.\",\n  \"pull to sync\": \"Tirer pour synchroniser\",\n  \"syncing\": \"En cours de synchronisation\",\n  \"contacts_sync\": \"Synchronisation des contacts\",\n  \"contacts_sync_to_pouch\": \"Synchronisation des contacts\",\n  \"contacts_sync_to_cozy\": \"Synchronisation des contacts\",\n  \"contacts_sync_to_phone\": \"Synchronisation des contacts\",\n  \"pictures_sync\": \"Synchronisation des images\",\n  \"cache_update\": \"Mise  jour du cache\",\n  \"destroying database\": \"Destruction de la base de donnes\",\n  \"synchronized with\": \"Synchronis avec \",\n  \"this folder is empty\": \"Ce dossier est vide.\",\n  \"no results\": \"Pas de rsultats\",\n  \"loading\": \"Chargement\",\n  \"remove local\": \"Supprimer du tl.\",\n  \"download\": \"Tlcharger\",\n  \"sync\": \"Synchroniser\",\n  \"backup\": \"Sauvegarder\",\n  \"save\": \"Sauvegarder\",\n  \"done\": \"Fait\",\n  \"photos\": \"Appareils photo\",\n  \"confirm message\": \"tes-vous sr(e)?\",\n  \"confirm exit message\": \"Voulez-vous quitter l'application?\",\n  \"replication complete\": \"Reproduction termine.\",\n  \"next\": \"Suivant\",\n  \"back\": \"Retour\",\n  \"connection failure\": \"chec de la connexion\",\n  \"setup 1/3\": \"Configuration 1/3\",\n  \"cozy welcome\": \"Bienvenue !\",\n  \"cozy welcome message\": \"L'application Cozy vous permet de: <ul><li>Consulter vos Fichiers</li><li>Synchroniser vos Contacts</li><li>Sauvegarder vos Photos</li></ul>\",\n  \"cozy welcome no account\": \"Si vous n'avez pas encore d'instance Cozy, rendez-vous sur <a target='_system' href='http://cozy.io/fr/'>cozy.io</a> pour en savoir plus.\",\n  \"url placeholder\": \"Votre Adresse Cozy\",\n  \"password placeholder\": \"Votre Mot de Passe\",\n  \"authenticating...\": \"Vrification des identifiants\",\n  \"setup 2/3\": \"Configuration 2/3\",\n  \"device name explanation\": \"Choisissez un nom pour ce priphrique afin de le grer facilement.\",\n  \"device name placeholder\": \"mon-telephone\",\n  \"registering...\": \"Enregistrement\",\n  \"setup 3/3\": \"Configuration 3/3\",\n  \"setup end\": \"Fin de la configuration\",\n  \"wait message device\": \"Enregistrement de l'appareil\",\n  \"message step 0\": \"Etape 1/5 : Synchronisation des fichiers.\",\n  \"message step 1\": \"Etape 2/5 : Synchronisation des dossiers.\",\n  \"message step 2\": \"Etape 3/5 : Synchronisation des notifications.\",\n  \"message step 3\": \"Etape 4/5 : Synchronisation des contacts.\",\n  \"message step 4\": \"Etape 5/5 : Prparation des documents.\",\n  \"ready message\": \"L'application est prte  tre utilise!\",\n  \"waiting...\": \"En attente\",\n  \"filesystem bug error\": \"Erreur dans le systme de fichiers. Essayez de redmarrer votre tlphone\",\n  \"end\": \"Fin\",\n  \"all fields are required\": \"Tous les champs sont obligatoires\",\n  \"cozy need patch\": \"Cozy a besoin d'un correctif\",\n  \"wrong password\": \"Mot de passe incorrect\",\n  \"device name already exist\": \"Ce nom d'appareil existe dj\",\n  \"An error happened (UNKNOWN)\": \"Une erreur est survenue\",\n  \"An error happened (NOT FOUND)\": \"Une erreur est survenue (non trouv)\",\n  \"An error happened (INVALID URL)\": \"Une erreur est survenue (url invalide)\",\n  \"This file isnt available offline\": \"Ce fichier n'est pas disponible hors ligne\",\n  \"ABORTED\": \"La procdure a t interrompue.\",\n  \"photo folder not replicated yet\": \"L'initialisation n'est pas termine.\",\n  \"Not Found\": \"Erreur  l'initialisation. Avez-vous install l'application Files sur votre Cozy ?\",\n  \"connexion error\": \"La connection  votre cozy a chou. Vrifiez que votre terminal est connect  internet, que l'adresse de votre cozy est bien crite et que votre cozy fonctionne. Pour les utilisateurs avancs avec un cozy auto-hberg, consulter la <a href='http://cozy.io/fr/mobile/files.html#a-propos-des-certificats-auto-sign-s' target='_system'>documentation  propos des certificats autosigns</a>\",\n  \"no images in DCIM\": \"Sauvegarde des images : aucune image trouve dans le rpertoire DCIM.\",\n  \"Document update conflict\": \"Conflit lors d'une opration en base de donnes. Essayez de redmarrer l'application pour le rsoudre.\",\n  \"Database not initialized. Confirm initialize\": \"L'initialisation ne s'est pas droul conrectement. Ressayer ?\",\n  \"no activity found\": \"Aucune application n'a t trouve sur ce tlphone pour ce type de fichier.\",\n  \"not enough space\": \"Il n'y a pas suffisament d'espace disque sur votre mobile.\",\n  \"no battery\": \"La synchronisation n'aura pas lieu car vous n'avez pas assez de batterie.\",\n  \"no wifi\": \"La synchronisation n'aura pas lieu car vous n'tes pas en wifi.\",\n  \"no connection\": \"La synchronisation n'aura pas lieu car vous n'avez pas de connexion.\"\n};\n","var Contact, log;\n\nlog = require('../lib/persistent_log')({\n  prefix: \"contact\",\n  date: true\n});\n\nmodule.exports = Contact = {\n  _n2ContactName: function(n) {\n    var familyName, formatted, givenName, middle, parts, prefix, suffix, validParts;\n    if (n == null) {\n      return void 0;\n    }\n    parts = n.split(';');\n    familyName = parts[0], givenName = parts[1], middle = parts[2], prefix = parts[3], suffix = parts[4];\n    validParts = parts.filter(function(part) {\n      return (part != null) && part !== '';\n    });\n    formatted = validParts.join(' ');\n    return new ContactName(formatted, familyName, givenName, middle, prefix, suffix);\n  },\n  _cozyContact2ContactOrganizations: function(contact) {\n    if (contact.org) {\n      return [new ContactOrganization(false, null, contact.org, contact.department, contact.title)];\n    } else {\n      return [];\n    }\n  },\n  _cozyContact2URLs: function(contact) {\n    if (contact.url) {\n      return [new ContactField('other', contact.url, false)];\n    } else {\n      return [];\n    }\n  },\n  _tags2Categories: function(tags) {\n    if (tags) {\n      return tags.map(function(tag) {\n        return new ContactField('categories', tag, false);\n      });\n    } else {\n      return [];\n    }\n  },\n  _attachments2Photos: function(contact) {\n    var photo;\n    if ((contact._attachments != null) && 'picture' in contact._attachments) {\n      photo = new ContactField('base64', contact._attachments.picture.data);\n      return [photo];\n    }\n    return [];\n  },\n  _adr2ContactAddress: function(datapoint) {\n    var countryPart, formatted, street, structuredToFlat;\n    structuredToFlat = function(t) {\n      t = t.filter(function(part) {\n        return (part != null) && part !== '';\n      });\n      return t.join(', ');\n    };\n    street = structuredToFlat(datapoint.value.slice(0, 3));\n    countryPart = structuredToFlat(datapoint.value.slice(3, 7));\n    formatted = street;\n    if (countryPart !== '') {\n      formatted += '\\n' + countryPart;\n    }\n    return new ContactAddress(void 0, datapoint.type, formatted, street, datapoint.value[3], datapoint.value[4], datapoint.value[5], datapoint.value[6]);\n  },\n  _dataPoints2Cordova: function(cozyContact, cordovaContact) {\n    var addContactField, datapoint, i, name, _ref, _results;\n    addContactField = function(cordovaField, datapoint) {\n      var field;\n      if (!cordovaContact[cordovaField]) {\n        cordovaContact[cordovaField] = [];\n      }\n      field = new ContactField(datapoint.type, datapoint.value);\n      return cordovaContact[cordovaField].push(field);\n    };\n    _ref = cozyContact.datapoints;\n    _results = [];\n    for (i in _ref) {\n      datapoint = _ref[i];\n      name = datapoint.name.toUpperCase();\n      switch (name) {\n        case 'TEL':\n          _results.push(addContactField('phoneNumbers', datapoint));\n          break;\n        case 'EMAIL':\n          _results.push(addContactField('emails', datapoint));\n          break;\n        case 'ADR':\n          if (!cordovaContact.addresses) {\n            cordovaContact.addresses = [];\n          }\n          _results.push(cordovaContact.addresses.push(this._adr2ContactAddress(datapoint)));\n          break;\n        case 'CHAT':\n          _results.push(addContactField('ims', datapoint));\n          break;\n        case 'SOCIAL':\n        case 'URL':\n          _results.push(addContactField('urls', datapoint));\n          break;\n        case 'ABOUT':\n          _results.push(addContactField('about', datapoint));\n          break;\n        case 'RELATION':\n          _results.push(addContactField('relations', datapoint));\n          break;\n        default:\n          _results.push(void 0);\n      }\n    }\n    return _results;\n  },\n  _cozy2CordovaOptions: function(cozyContact) {\n    var cordovaContact;\n    cordovaContact = {\n      displayName: cozyContact.fn,\n      name: Contact._n2ContactName(cozyContact.n),\n      nickname: cozyContact.nickname,\n      organizations: Contact._cozyContact2ContactOrganizations(cozyContact),\n      birthday: cozyContact.bday,\n      urls: Contact._cozyContact2URLs(cozyContact),\n      note: cozyContact.note,\n      categories: Contact._tags2Categories(cozyContact.tags),\n      photos: Contact._attachments2Photos(cozyContact),\n      sourceId: cozyContact._id,\n      sync2: cozyContact._rev,\n      dirty: false,\n      deleted: false\n    };\n    Contact._dataPoints2Cordova(cozyContact, cordovaContact);\n    if (!cordovaContact.displayName) {\n      cordovaContact.displayName = \"--\";\n    }\n    return cordovaContact;\n  },\n  cozy2Cordova: function(cozyContact) {\n    return navigator.contacts.create(Contact._cozy2CordovaOptions(cozyContact));\n  },\n  _contactName2N: function(contactName) {\n    var field, n, parts, _i, _len, _ref;\n    if (contactName == null) {\n      return void 0;\n    }\n    parts = [];\n    _ref = ['familyName', 'givenName', 'middleName', 'honorificPrefix', 'honorificSuffix'];\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      field = _ref[_i];\n      parts.push(contactName[field] || '');\n    }\n    n = parts.join(';');\n    if (n !== ';;;;') {\n      return n;\n    }\n  },\n  _categories2Tags: function(categories) {\n    if (categories != null) {\n      return categories.map(function(categorie) {\n        return category.value;\n      });\n    }\n  },\n  _organizations2Cozy: function(organizations, cozyContact) {\n    var organization;\n    if ((organizations != null ? organizations.length : void 0) > 0) {\n      organization = organizations[0];\n      cozyContact.org = organization.name;\n      cozyContact.department = organization.department;\n      return cozyContact.title = organization.title;\n    }\n  },\n  _cordova2Datapoints: function(cordovaContact, cozyContact) {\n    var datapoints, field2Name, fieldName, fields, fieldsDatapoints, name, _ref, _ref1;\n    datapoints = [];\n    field2Name = {\n      'phoneNumbers': 'tel',\n      'emails': 'email',\n      'ims': 'chat',\n      'about': 'about',\n      'relations': 'relation'\n    };\n    for (fieldName in field2Name) {\n      name = field2Name[fieldName];\n      fields = cordovaContact[fieldName];\n      if ((fields != null ? fields.length : void 0) > 0) {\n        fieldsDatapoints = fields.map(function(contactField) {\n          return {\n            name: name,\n            type: contactField.type,\n            value: contactField.value\n          };\n        });\n        datapoints = datapoints.concat(fieldsDatapoints);\n      }\n    }\n    if (((_ref = cordovaContact.addresses) != null ? _ref.length : void 0) > 0) {\n      fieldsDatapoints = cordovaContact.addresses.map(function(contactAddress) {\n        return {\n          name: 'adr',\n          type: contactAddress.type,\n          value: ['', '', contactAddress.formatted, '', '', '', '']\n        };\n      });\n      datapoints = datapoints.concat(fieldsDatapoints);\n    }\n    if (((_ref1 = cordovaContact.urls) != null ? _ref1.length : void 0) > 0) {\n      cozyContact.url = cordovaContact.urls[0].value;\n      fieldsDatapoints = cordovaContact.urls.slice(1).map(function(contactField) {\n        return {\n          name: 'url',\n          type: contactField.type,\n          value: contactField.value\n        };\n      });\n      datapoints = datapoints.concat(fieldsDatapoints);\n    }\n    return cozyContact.datapoints = datapoints;\n  },\n  cordova2Cozy: function(cordovaContact, callback) {\n    var cozyContact, img, photo, _ref;\n    cozyContact = {\n      docType: 'contact',\n      _id: cordovaContact.sourceId,\n      id: cordovaContact.sourceId,\n      _rev: cordovaContact.sync2,\n      fn: cordovaContact.displayName,\n      n: Contact._contactName2N(cordovaContact.name),\n      bday: cordovaContact.birthday,\n      nickname: cordovaContact.nickname,\n      revision: new Date().toISOString(),\n      note: cordovaContact.note,\n      tags: Contact._categories2Tags(cordovaContact.categories)\n    };\n    Contact._organizations2Cozy(cordovaContact.organizations, cozyContact);\n    Contact._cordova2Datapoints(cordovaContact, cozyContact);\n    if (!(((_ref = cordovaContact.photos) != null ? _ref.length : void 0) > 0)) {\n      return callback(null, cozyContact);\n    }\n    photo = cordovaContact.photos[0];\n    if (photo.type === 'base64') {\n      cozyContact._attachments = {\n        picture: {\n          content_type: 'application/octet-stream',\n          data: photo.value\n        }\n      };\n      return callback(null, cozyContact);\n    } else if (photo.type === 'url') {\n      img = new Image();\n      img.onload = function() {\n        var IMAGE_DIMENSION, canvas, ctx, dataUrl, ratio, ratiodim;\n        IMAGE_DIMENSION = 600;\n        ratiodim = img.width > img.height ? 'height' : 'width';\n        ratio = IMAGE_DIMENSION / img[ratiodim];\n        canvas = document.createElement('canvas');\n        canvas.height = canvas.width = IMAGE_DIMENSION;\n        ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, ratio * img.width, ratio * img.height);\n        dataUrl = canvas.toDataURL('image/jpeg');\n        cozyContact._attachments = {\n          picture: {\n            content_type: 'application/octet-stream',\n            data: dataUrl.split(',')[1]\n          }\n        };\n        return callback(null, cozyContact);\n      };\n      return img.src = photo.value;\n    }\n  }\n};\n","var File,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = File = (function(_super) {\n  __extends(File, _super);\n\n  function File() {\n    return File.__super__.constructor.apply(this, arguments);\n  }\n\n  File.prototype.idAttribute = \"_id\";\n\n  File.prototype.defaults = function() {\n    return {\n      incache: 'loading',\n      version: false\n    };\n  };\n\n  File.prototype.initialize = function() {\n    return this.isDeviceFolder = this.isFolder() && this.wholePath() === app.replicator.config.get('deviceName');\n  };\n\n  File.prototype.isFolder = function() {\n    var _ref;\n    return ((_ref = this.get('docType')) != null ? _ref.toLowerCase() : void 0) === 'folder';\n  };\n\n  File.prototype.wholePath = function() {\n    var name, path;\n    name = this.get('name');\n    if (path = this.get('path')) {\n      return \"\" + (path.slice(1)) + \"/\" + name;\n    } else {\n      return name;\n    }\n  };\n\n  return File;\n\n})(Backbone.Model);\n","var DOWNLOADS_FOLDER, basic, fs, getFileSystem, log, readable, __chromeSafe;\n\nbasic = require('../lib/basic');\n\nDOWNLOADS_FOLDER = 'cozy-downloads';\n\nlog = require('/lib/persistent_log')({\n  prefix: \"replicator mapreduce\",\n  date: true\n});\n\nmodule.exports = fs = {};\n\ngetFileSystem = function(callback) {\n  var onError, onSuccess;\n  onSuccess = function(fs) {\n    return callback(null, fs);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  if (window.isBrowserDebugging) {\n    __chromeSafe();\n  }\n  return window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onSuccess, onError);\n};\n\nreadable = function(err) {\n  var code, name;\n  for (name in FileError) {\n    code = FileError[name];\n    if (code === err.code) {\n      return new Error(name.replace('_ERR', '').replace('_', ' '));\n    }\n  }\n  return new Error(JSON.stringify(err));\n};\n\nmodule.exports.initialize = function(callback) {\n  return getFileSystem((function(_this) {\n    return function(err, filesystem) {\n      if (err) {\n        return callback(readable(err));\n      }\n      window.FileTransfer.fs = filesystem;\n      return fs.getOrCreateSubFolder(filesystem.root, DOWNLOADS_FOLDER, function(err, downloads) {\n        if (err) {\n          return callback(readable(err));\n        }\n        downloads.getFile('.nomedia', {\n          create: true,\n          exclusive: false\n        }, function() {\n          return log.info(\"NOMEDIA FILE CREATED\");\n        }, function() {\n          return log.info(\"NOMEDIA FILE NOT CREATED\");\n        });\n        return fs.getChildren(downloads, function(err, children) {\n          if (err) {\n            return callback(readable(err));\n          }\n          return callback(null, downloads, children);\n        });\n      });\n    };\n  })(this));\n};\n\nmodule.exports[\"delete\"] = function(entry, callback) {\n  var onError, onSuccess;\n  onSuccess = function() {\n    return callback(null);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.remove(onSuccess, onError);\n};\n\nmodule.exports.getFile = function(parent, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getFile(name, null, onSuccess, onError);\n};\n\nmodule.exports.moveTo = function(entry, directory, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.moveTo(directory, name, null, onSuccess, onError);\n};\n\nmodule.exports.getDirectory = function(parent, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getDirectory(name, {}, onSuccess, onError);\n};\n\nmodule.exports.getOrCreateSubFolder = function(parent, name, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return parent.getDirectory(name, {\n    create: true\n  }, onSuccess, function(err) {\n    if (err.code !== FileError.PATH_EXISTS_ERR) {\n      return callback(err);\n    }\n    return parent.getDirectory(name, {}, onSuccess, function(err) {\n      if (err.code !== FileError.NOT_FOUND_ERR) {\n        return callback(err);\n      }\n      return callback(new Error(t('filesystem bug error')));\n    });\n  });\n};\n\nmodule.exports.getChildren = function(directory, callback) {\n  var onError, onSuccess, reader;\n  reader = directory.createReader();\n  onSuccess = function(entries) {\n    return callback(null, entries);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return reader.readEntries(onSuccess, onError);\n};\n\nmodule.exports.rmrf = function(directory, callback) {\n  var onError, onSuccess;\n  onError = function(err) {\n    return callback(err);\n  };\n  onSuccess = function() {\n    return callback(null);\n  };\n  return directory.removeRecursively(onSuccess, onError);\n};\n\nmodule.exports.freeSpace = function(callback) {\n  var onError, onSuccess;\n  onError = function(err) {\n    return callback(err);\n  };\n  onSuccess = function() {\n    return callback(null);\n  };\n  return cordova.exec(onSuccess, onError, 'File', 'getFreeDiskSpace', []);\n};\n\nmodule.exports.entryFromPath = function(path, callback) {\n  var onError, onSuccess;\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return resolveLocalFileSystemURL('file://' + path, onSuccess, onError);\n};\n\nmodule.exports.fileFromEntry = function(entry, callback) {\n  var onError, onSuccess;\n  onSuccess = function(file) {\n    return callback(null, file);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.file(onSuccess, onError);\n};\n\nmodule.exports.contentFromFile = function(file, callback) {\n  var reader;\n  reader = new FileReader();\n  reader.onerror = callback;\n  reader.onload = function() {\n    return callback(null, reader.result);\n  };\n  return reader.readAsArrayBuffer(file);\n};\n\nmodule.exports.getFileFromPath = function(path, callback) {\n  return fs.entryFromPath(path, function(err, entry) {\n    if (err) {\n      return callback(err);\n    }\n    return fs.fileFromEntry(entry, callback);\n  });\n};\n\nmodule.exports.metadataFromEntry = function(entry, callback) {\n  var onError, onSuccess;\n  onSuccess = function(file) {\n    return callback(null, file);\n  };\n  onError = function(err) {\n    return callback(err);\n  };\n  return entry.getMetadata(onSuccess, onError);\n};\n\nmodule.exports.download = function(options, progressback, callback) {\n  var auth, errors, ft, headers, onError, onSuccess, path, url;\n  errors = ['An error happened (UNKNOWN)', 'An error happened (NOT FOUND)', 'An error happened (INVALID URL)', 'This file isnt available offline', 'ABORTED'];\n  options = (url = options.url, path = options.path, auth = options.auth, options);\n  url = encodeURI(url);\n  onSuccess = function(entry) {\n    return callback(null, entry);\n  };\n  onError = function(err) {\n    return callback(new Error(errors[err.code]));\n  };\n  ft = new FileTransfer();\n  ft.onprogress = function(e) {\n    if (e.lengthComputable) {\n      return progressback(e.loaded, e.total);\n    } else {\n      return progressback(3, 10);\n    }\n  };\n  headers = {\n    Authorization: basic(auth)\n  };\n  return ft.download(url, path, onSuccess, onError, true, {\n    headers: headers\n  });\n};\n\n__chromeSafe = function() {\n  var FileTransfer;\n  window.LocalFileSystem = {\n    PERSISTENT: window.PERSISTENT\n  };\n  window.requestFileSystem = function(type, size, onSuccess, onError) {\n    size = 5 * 1024 * 1024;\n    return navigator.webkitPersistentStorage.requestQuota(size, function(granted) {\n      return window.webkitRequestFileSystem(type, granted, onSuccess, onError);\n    }, onError);\n  };\n  window.ImagesBrowser = {\n    getImageList: function() {\n      return [];\n    }\n  };\n  return window.FileTransfer = FileTransfer = (function() {\n    function FileTransfer() {}\n\n    FileTransfer.prototype.download = function(url, local, onSuccess, onError, _, options) {\n      var key, value, xhr, _ref;\n      xhr = new XMLHttpRequest();\n      xhr.open('GET', url, true);\n      xhr.overrideMimeType('text/plain; charset=x-user-defined');\n      xhr.responseType = \"arraybuffer\";\n      _ref = options.headers;\n      for (key in _ref) {\n        value = _ref[key];\n        xhr.setRequestHeader(key, value);\n      }\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState !== 4) {\n          return;\n        }\n        return FileTransfer.fs.root.getFile(local, {\n          create: true\n        }, function(entry) {\n          return entry.createWriter(function(writer) {\n            var bb;\n            writer.onwrite = function() {\n              return onSuccess(entry);\n            };\n            writer.onerror = function(err) {\n              return onError(err);\n            };\n            bb = new BlobBuilder();\n            bb.append(xhr.response);\n            return writer.write(bb.getBlob(mimetype));\n          }, function(err) {\n            return onError(err);\n          });\n        }, function(err) {\n          return onError(err);\n        });\n      };\n      return xhr.send(null);\n    };\n\n    return FileTransfer;\n\n  })();\n};\n","var DBNAME, DBOPTIONS, DBPHOTOS, DeviceStatus, Replicator, ReplicatorConfig, fs, log, makeDesignDocs, request,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nrequest = require('../lib/request');\n\nfs = require('./filesystem');\n\nmakeDesignDocs = require('./replicator_mapreduce');\n\nReplicatorConfig = require('./replicator_config');\n\nDeviceStatus = require('../lib/device_status');\n\nDBNAME = \"cozy-files.db\";\n\nDBPHOTOS = \"cozy-photos.db\";\n\nDBOPTIONS = window.isBrowserDebugging ? {} : {\n  adapter: 'websql'\n};\n\nlog = require('/lib/persistent_log')({\n  prefix: \"replicator\",\n  date: true\n});\n\nmodule.exports = Replicator = (function(_super) {\n  var realtimeBackupCoef;\n\n  __extends(Replicator, _super);\n\n  function Replicator() {\n    this.syncCache = __bind(this.syncCache, this);\n    this.stopRealtime = __bind(this.stopRealtime, this);\n    this.startRealtime = __bind(this.startRealtime, this);\n    this.updateLocal = __bind(this.updateLocal, this);\n    this.folderInFileSystem = __bind(this.folderInFileSystem, this);\n    this.fileVersion = __bind(this.fileVersion, this);\n    this.fileInFileSystem = __bind(this.fileInFileSystem, this);\n    return Replicator.__super__.constructor.apply(this, arguments);\n  }\n\n  Replicator.prototype.db = null;\n\n  Replicator.prototype.config = null;\n\n  _.extend(Replicator.prototype, require('./replicator_backups'));\n\n  _.extend(Replicator.prototype, require('./replicator_contacts'));\n\n  Replicator.prototype.defaults = function() {\n    return {\n      inSync: false,\n      inBackup: false\n    };\n  };\n\n  Replicator.prototype.init = function(callback) {\n    return fs.initialize((function(_this) {\n      return function(err, downloads, cache) {\n        if (err) {\n          return callback(err);\n        }\n        _this.downloads = downloads;\n        _this.cache = cache;\n        _this.db = new PouchDB(DBNAME, DBOPTIONS);\n        _this.photosDB = new PouchDB(DBPHOTOS, DBOPTIONS);\n        return makeDesignDocs(_this.db, _this.photosDB, function(err) {\n          if (err) {\n            return callback(err);\n          }\n          _this.config = new ReplicatorConfig(_this);\n          return _this.config.fetch(callback);\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.destroyDB = function(callback) {\n    return this.db.destroy((function(_this) {\n      return function(err) {\n        if (err) {\n          return callback(err);\n        }\n        return _this.photosDB.destroy(function(err) {\n          if (err) {\n            return callback(err);\n          }\n          return fs.rmrf(_this.downloads, callback);\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.checkCredentials = function(config, callback) {\n    return request.post({\n      uri: \"\" + (this.config.getScheme()) + \"://\" + config.cozyURL + \"/login\",\n      json: {\n        username: 'owner',\n        password: config.password\n      }\n    }, function(err, response, body) {\n      var error;\n      if ((response != null ? response.status : void 0) === 0) {\n        error = t('connexion error');\n      } else if ((response != null ? response.statusCode : void 0) !== 200) {\n        error = (err != null ? err.message : void 0) || body.error || body.message;\n      } else {\n        error = null;\n      }\n      return callback(error);\n    });\n  };\n\n  Replicator.prototype.registerRemote = function(config, callback) {\n    return request.post({\n      uri: \"\" + (this.config.getScheme()) + \"://\" + config.cozyURL + \"/device/\",\n      auth: {\n        username: 'owner',\n        password: config.password\n      },\n      json: {\n        login: config.deviceName,\n        type: 'mobile'\n      }\n    }, (function(_this) {\n      return function(err, response, body) {\n        if (err) {\n          return callback(err);\n        } else if (response.statusCode === 401 && response.reason) {\n          return callback(new Error('cozy need patch'));\n        } else if (response.statusCode === 401) {\n          return callback(new Error('wrong password'));\n        } else if (response.statusCode === 400) {\n          return callback(new Error('device name already exist'));\n        } else {\n          _.extend(config, {\n            password: body.password,\n            deviceId: body.id,\n            auth: {\n              username: config.deviceName,\n              password: body.password\n            },\n            fullRemoteURL: (\"\" + (_this.config.getScheme()) + \"://\" + config.deviceName + \":\" + body.password) + (\"@\" + config.cozyURL + \"/cozy\")\n          });\n          return _this.config.save(config, callback);\n        }\n      };\n    })(this));\n  };\n\n  Replicator.prototype.initialReplication = function(callback) {\n    return DeviceStatus.checkReadyForSync((function(_this) {\n      return function(err, ready, msg) {\n        var options;\n        if (err) {\n          return callback(err);\n        }\n        if (!ready) {\n          return callback(new Error(msg));\n        }\n        log.info(\"enter initialReplication\");\n        _this.stopRealtime();\n        _this.set('initialReplicationStep', 0);\n        options = _this.config.makeUrl('/_changes?descending=true&limit=1');\n        return request.get(options, function(err, res, body) {\n          var last_seq;\n          if (err) {\n            return callback(err);\n          }\n          last_seq = body.last_seq;\n          return async.series([\n            function(cb) {\n              return _this.copyView('file', cb);\n            }, function(cb) {\n              return _this.set('initialReplicationStep', 1) && cb(null);\n            }, function(cb) {\n              return _this.copyView('folder', cb);\n            }, function(cb) {\n              return _this.set('initialReplicationStep', 2) && cb(null);\n            }, function(cb) {\n              return _this.copyView('notification', cb);\n            }, function(cb) {\n              return _this.set('initialReplicationStep', 3) && cb(null);\n            }, function(cb) {\n              return _this.initContactsInPhone(last_seq, cb);\n            }, function(cb) {\n              return _this.set('initialReplicationStep', 4) && cb(null);\n            }, function(cb) {\n              return _this.config.save({\n                checkpointed: last_seq\n              }, cb);\n            }, function(cb) {\n              return _this.db.query('FilesAndFolder', {}, cb);\n            }, function(cb) {\n              return _this.db.query('NotificationsTemporary', {}, cb);\n            }\n          ], function(err) {\n            log.info(\"end of inital replication\");\n            _this.set('initialReplicationStep', 5);\n            callback(err);\n            return _this.updateIndex(function() {\n              return log.info(\"Index built\");\n            });\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.copyView = function(model, callback) {\n    var handleResponse, options, options2;\n    log.info(\"enter copyView for \" + model + \".\");\n    if (model === 'file' || model === 'folder') {\n      options = this.config.makeUrl(\"/_design/\" + model + \"/_view/files-all/\");\n      options2 = this.config.makeUrl(\"/_design/\" + model + \"/_view/all/\");\n    } else {\n      options = this.config.makeUrl(\"/_design/\" + model + \"/_view/all/\");\n    }\n    handleResponse = (function(_this) {\n      return function(err, res, body) {\n        var _ref;\n        if (!err && res.status > 399) {\n          log.info(\"Unexpected response: \" + res);\n          err = new Error(res.statusText);\n        }\n        if (err) {\n          return callback(err);\n        }\n        if (!((_ref = body.rows) != null ? _ref.length : void 0)) {\n          return callback(null);\n        }\n        return async.eachSeries(body.rows, function(doc, cb) {\n          doc = doc.value;\n          return _this.db.put(doc, {\n            'new_edits': false\n          }, function(err, file) {\n            return cb();\n          });\n        }, callback);\n      };\n    })(this);\n    return request.get(options, function(err, res, body) {\n      if (res.status === 404 && (model === 'file' || model === 'folder')) {\n        return request.get(options2, handleResponse);\n      } else {\n        return handleResponse(err, res, body);\n      }\n    });\n  };\n\n  Replicator.prototype.updateIndex = function(callback) {\n    return this.db.search({\n      build: true,\n      fields: ['name']\n    }, (function(_this) {\n      return function(err) {\n        log.info(\"INDEX BUILT\");\n        if (err) {\n          log.warn(err);\n        }\n        return _this.db.query('FilesAndFolder', {}, function() {\n          return _this.db.query('LocalPath', {}, function() {\n            return callback(null);\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.fileToEntryName = function(file) {\n    return file.binary.file.id + '-' + file.binary.file.rev;\n  };\n\n  Replicator.prototype.fileInFileSystem = function(file) {\n    if (file.docType.toLowerCase() === 'file') {\n      return this.cache.some(function(entry) {\n        return entry.name.indexOf(file.binary.file.id) !== -1;\n      });\n    }\n  };\n\n  Replicator.prototype.fileVersion = function(file) {\n    if (file.docType.toLowerCase() === 'file') {\n      return this.cache.some((function(_this) {\n        return function(entry) {\n          return entry.name === _this.fileToEntryName(file);\n        };\n      })(this));\n    }\n  };\n\n  Replicator.prototype.folderInFileSystem = function(path, callback) {\n    var fsCacheFolder, options;\n    options = {\n      startkey: path,\n      endkey: path + '\\uffff'\n    };\n    fsCacheFolder = this.cache.map(function(entry) {\n      return entry.name;\n    });\n    return this.db.query('PathToBinary', options, function(err, results) {\n      if (err) {\n        return callback(err);\n      }\n      if (results.rows.length === 0) {\n        return callback(null, null);\n      }\n      return callback(null, _.every(results.rows, function(row) {\n        var _ref;\n        return _ref = row.value, __indexOf.call(fsCacheFolder, _ref) >= 0;\n      }));\n    });\n  };\n\n  Replicator.prototype.removeFromCacheList = function(entryName) {\n    var currentEntry, index, _i, _len, _ref, _results;\n    _ref = this.cache;\n    _results = [];\n    for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {\n      currentEntry = _ref[index];\n      if (!(currentEntry.name === entryName)) {\n        continue;\n      }\n      this.cache.splice(index, 1);\n      break;\n    }\n    return _results;\n  };\n\n  Replicator.prototype.getBinary = function(model, progressback, callback) {\n    return fs.getOrCreateSubFolder(this.downloads, this.fileToEntryName(model), (function(_this) {\n      return function(err, binfolder) {\n        if (err && err.code !== FileError.PATH_EXISTS_ERR) {\n          return callback(err);\n        }\n        if (!model.name) {\n          return callback(new Error('no model name :' + JSON.stringify(model)));\n        }\n        return fs.getFile(binfolder, model.name, function(err, entry) {\n          var options;\n          if (entry) {\n            return callback(null, entry.toURL());\n          }\n          options = _this.config.makeUrl(\"/\" + model.binary.file.id + \"/file\");\n          options.path = binfolder.toURL() + '/' + model.name;\n          log.info(\"download binary of \" + model.name);\n          return fs.download(options, progressback, function(err, entry) {\n            var found;\n            if (((err != null ? err.message : void 0) != null) && err.message === \"This file isnt available offline\" && _this.fileInFileSystem(model)) {\n              found = false;\n              _this.cache.some(function(entry) {\n                if (entry.name.indexOf(binary_id) !== -1) {\n                  found = true;\n                  return callback(null, entry.toURL() + '/' + model.name);\n                }\n              });\n              if (!found) {\n                return callback(err);\n              }\n            } else if (err) {\n              return fs[\"delete\"](binfolder, function(delerr) {\n                return callback(err);\n              });\n            } else {\n              _this.cache.push(binfolder);\n              callback(null, entry.toURL());\n              return _this.removeAllLocal(model, function() {});\n            }\n          });\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.removeAllLocal = function(file, callback) {\n    var id;\n    return id = async.eachSeries(this.cache, (function(_this) {\n      return function(entry, cb) {\n        if (entry.name.indexOf(file.binary.file.id) !== -1 && entry.name !== _this.fileToEntryName(file)) {\n          return fs.getDirectory(_this.downloads, entry.name, function(err, binfolder) {\n            if (err) {\n              return cb(err);\n            }\n            return fs.rmrf(binfolder, function(err) {\n              _this.removeFromCacheList(entry.name);\n              return cb();\n            });\n          });\n        } else {\n          return cb();\n        }\n      };\n    })(this), callback);\n  };\n\n  Replicator.prototype.getBinaryFolder = function(folder, progressback, callback) {\n    return this.getDbFilesOfFolder(folder, (function(_this) {\n      return function(err, files) {\n        var totalSize;\n        if (err) {\n          return callback(err);\n        }\n        totalSize = files.reduce((function(sum, file) {\n          return sum + file.size;\n        }), 0);\n        return fs.freeSpace(function(err, available) {\n          var progressHandlers, reportProgress;\n          if (err) {\n            return callback(err);\n          }\n          if (totalSize > available * 1024) {\n            log.warn('not enough space');\n            alert(t('not enough space'));\n            return callback(null);\n          } else {\n            progressHandlers = {};\n            reportProgress = function(id, done, total) {\n              var key, status;\n              progressHandlers[id] = [done, total];\n              total = done = 0;\n              for (key in progressHandlers) {\n                status = progressHandlers[key];\n                done += status[0];\n                total += status[1];\n              }\n              return progressback(done, total);\n            };\n            return async.eachLimit(files, 5, function(file, cb) {\n              var pb;\n              pb = reportProgress.bind(null, file._id);\n              return _this.getBinary(file, pb, cb);\n            }, callback);\n          }\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.getDbFilesOfFolder = function(folder, callback) {\n    var options, path;\n    path = folder.path;\n    path += '/' + folder.name;\n    options = {\n      startkey: [path],\n      endkey: [path + '/\\uffff', {}],\n      include_docs: true\n    };\n    return this.db.query('FilesAndFolder', options, function(err, results) {\n      var docs, files;\n      if (err) {\n        return callback(err);\n      }\n      docs = results.rows.map(function(row) {\n        return row.doc;\n      });\n      files = docs.filter(function(doc) {\n        var _ref;\n        return ((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file';\n      });\n      return callback(null, files);\n    });\n  };\n\n  Replicator.prototype.updateLocal = function(options, callback) {\n    var entry, file, noop;\n    file = options.file;\n    entry = options.entry;\n    noop = function() {};\n    if (file._deleted) {\n      return this.removeLocal(file, callback);\n    } else if (entry.name !== this.fileToEntryName(file)) {\n      return DeviceStatus.checkReadyForSync((function(_this) {\n        return function(err, ready, msg) {\n          if (err) {\n            return callback(err);\n          }\n          if (ready) {\n            return _this.getBinary(file, noop, callback);\n          } else {\n            return callback(new Error(msg));\n          }\n        };\n      })(this));\n    } else {\n      return fs.getChildren(entry, (function(_this) {\n        return function(err, children) {\n          if (err) {\n            return callback(err);\n          }\n          if (children.length === 0) {\n            log.warn(\"Missing file \" + file.name + \" on device, fetching it.\");\n            return _this.getBinary(file, noop, callback);\n          } else if (children[0].name === file.name) {\n            return callback();\n          } else {\n            return fs.moveTo(children[0], entry, file.name, callback);\n          }\n        };\n      })(this));\n    }\n  };\n\n  Replicator.prototype.removeLocal = function(file, callback) {\n    log.info(\"remove \" + file.name + \" from cache.\");\n    return fs.getDirectory(this.downloads, this.fileToEntryName(file), (function(_this) {\n      return function(err, binfolder) {\n        if (err) {\n          return callback(err);\n        }\n        return fs.rmrf(binfolder, function(err) {\n          _this.removeFromCacheList(_this.fileToEntryName(file));\n          return callback(err);\n        });\n      };\n    })(this));\n  };\n\n  Replicator.prototype.removeLocalFolder = function(folder, callback) {\n    return this.getDbFilesOfFolder(folder, (function(_this) {\n      return function(err, files) {\n        if (err) {\n          return callback(err);\n        }\n        return async.eachSeries(files, function(file, cb) {\n          return _this.removeLocal(file, cb);\n        }, callback);\n      };\n    })(this));\n  };\n\n  Replicator.prototype._filesNEntriesInCache = function(docs) {\n    var entries, file, fileNEntriesInCache, _i, _len;\n    fileNEntriesInCache = [];\n    for (_i = 0, _len = docs.length; _i < _len; _i++) {\n      file = docs[_i];\n      if (file.docType.toLowerCase() === 'file' && (file.binary != null)) {\n        entries = this.cache.filter(function(entry) {\n          return entry.name.indexOf(file.binary.file.id) !== -1;\n        });\n        if (entries.length !== 0) {\n          fileNEntriesInCache.push({\n            file: file,\n            entry: entries[0]\n          });\n        }\n      }\n    }\n    return fileNEntriesInCache;\n  };\n\n  Replicator.prototype._replicationFilter = function() {\n    var filter;\n    if (this.config.get('cozyNotifications')) {\n      filter = function(doc) {\n        var _ref, _ref1, _ref2, _ref3;\n        return ((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'folder' || ((_ref1 = doc.docType) != null ? _ref1.toLowerCase() : void 0) === 'file' || ((_ref2 = doc.docType) != null ? _ref2.toLowerCase() : void 0) === 'notification' && ((_ref3 = doc.type) != null ? _ref3.toLowerCase() : void 0) === 'temporary';\n      };\n    } else {\n      filter = function(doc) {\n        var _ref, _ref1;\n        return ((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'folder' || ((_ref1 = doc.docType) != null ? _ref1.toLowerCase() : void 0) === 'file';\n      };\n    }\n    return filter;\n  };\n\n  Replicator.prototype.sync = function(options, callback) {\n    if (this.get('inSync')) {\n      return callback(null);\n    }\n    if (!this.config.has('checkpointed')) {\n      return callback(new Error(\"database not initialized\"));\n    }\n    log.info(\"start a sync\");\n    this.set('inSync', true);\n    return this._sync(options, (function(_this) {\n      return function(err) {\n        _this.set('inSync', false);\n        return callback(err);\n      };\n    })(this));\n  };\n\n  Replicator.prototype._sync = function(options, callback) {\n    var changedDocs, checkpoint, replication, total_count;\n    total_count = 0;\n    this.stopRealtime();\n    changedDocs = [];\n    checkpoint = this.config.get('checkpointed');\n    replication = this.db.replicate.from(this.config.remote, {\n      batch_size: 20,\n      batches_limit: 5,\n      filter: this._replicationFilter(),\n      live: false,\n      since: checkpoint\n    });\n    replication.on('change', (function(_this) {\n      return function(change) {\n        log.info(\"changes received while sync\");\n        return changedDocs = changedDocs.concat(change.docs);\n      };\n    })(this));\n    replication.once('error', (function(_this) {\n      return function(err) {\n        var _ref;\n        log.error(\"error while replication in sync\", err);\n        if (((err != null ? (_ref = err.result) != null ? _ref.status : void 0 : void 0) != null) && err.result.status === 'aborted') {\n          if (replication != null) {\n            replication.cancel();\n          }\n          return _this._sync(options, callback);\n        } else {\n          return callback(err);\n        }\n      };\n    })(this));\n    return replication.once('complete', (function(_this) {\n      return function(result) {\n        log.info(\"replication in sync completed.\");\n        return async.eachSeries(_this._filesNEntriesInCache(changedDocs), _this.updateLocal, function(err) {\n          if (err) {\n            log.warn(err);\n          }\n          return _this.config.save({\n            checkpointed: result.last_seq\n          }, function(err) {\n            callback(err);\n            if (!options.background) {\n              app.router.forceRefresh();\n              return _this.updateIndex(function() {\n                return _this.startRealtime();\n              });\n            }\n          });\n        });\n      };\n    })(this));\n  };\n\n  realtimeBackupCoef = 1;\n\n  Replicator.prototype.startRealtime = function() {\n    if (this.liveReplication || !app.foreground) {\n      return;\n    }\n    if (!this.config.has('checkpointed')) {\n      log.error(new Error(\"database not initialized\"));\n      if (confirm(t('Database not initialized. Do it now ?'))) {\n        app.router.navigate('first-sync', {\n          trigger: true\n        });\n      }\n      return;\n    }\n    log.info('REALTIME START');\n    this.liveReplication = this.db.replicate.from(this.config.remote, {\n      batch_size: 20,\n      batches_limit: 5,\n      filter: this._replicationFilter(),\n      since: this.config.get('checkpointed'),\n      continuous: true\n    });\n    this.liveReplication.on('change', (function(_this) {\n      return function(change) {\n        var event, fileNEntriesInCache;\n        realtimeBackupCoef = 1;\n        event = new Event('realtime:onChange');\n        window.dispatchEvent(event);\n        _this.set('inSync', true);\n        fileNEntriesInCache = _this._filesNEntriesInCache(change.docs);\n        return async.eachSeries(fileNEntriesInCache, _this.updateLocal, function(err) {\n          if (err) {\n            return log.error(err);\n          } else {\n            return log.info(\"updated binary in realtime\");\n          }\n        });\n      };\n    })(this));\n    this.liveReplication.on('uptodate', (function(_this) {\n      return function(e) {\n        realtimeBackupCoef = 1;\n        _this.set('inSync', false);\n        app.router.forceRefresh();\n        return log.info(\"UPTODATE realtime\", e);\n      };\n    })(this));\n    this.liveReplication.once('complete', (function(_this) {\n      return function(e) {\n        log.info(\"REALTIME CANCELLED\");\n        _this.set('inSync', false);\n        return _this.liveReplication = null;\n      };\n    })(this));\n    return this.liveReplication.once('error', (function(_this) {\n      return function(e) {\n        var timeout;\n        _this.liveReplication = null;\n        if (realtimeBackupCoef < 6) {\n          realtimeBackupCoef++;\n        }\n        timeout = 1000 * (1 << realtimeBackupCoef);\n        log.error(\"REALTIME BROKE, TRY AGAIN IN \" + timeout + \" \" + (e.toString()));\n        return _this.realtimeBackOff = setTimeout(_this.startRealtime, timeout);\n      };\n    })(this));\n  };\n\n  Replicator.prototype.stopRealtime = function() {\n    var _ref;\n    if ((_ref = this.liveReplication) != null) {\n      _ref.cancel();\n    }\n    return clearTimeout(this.realtimeBackOff);\n  };\n\n  Replicator.prototype.syncCache = function(callback) {\n    var options;\n    this.set('backup_step', 'cache_update');\n    this.set('backup_step_done', null);\n    options = {\n      keys: this.cache.map(function(entry) {\n        return entry.name.split('-')[0];\n      }),\n      include_docs: true\n    };\n    return this.db.query('ByBinaryId', options, (function(_this) {\n      return function(err, results) {\n        var processed, toUpdate;\n        if (err) {\n          return callback(err);\n        }\n        toUpdate = _this._filesNEntriesInCache(results.rows.map(function(row) {\n          return row.doc;\n        }));\n        processed = 0;\n        _this.set('backup_step', 'cache_update');\n        _this.set('backup_step_total', toUpdate.length);\n        return async.eachSeries(toUpdate, function(fileNEntry, cb) {\n          _this.set('backup_step_done', processed++);\n          return _this.updateLocal(fileNEntry, cb);\n        }, callback);\n      };\n    })(this));\n  };\n\n  return Replicator;\n\n})(Backbone.Model);\n","var DeviceStatus, fs, log, request,\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nDeviceStatus = require('../lib/device_status');\n\nfs = require('./filesystem');\n\nrequest = require('../lib/request');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"replicator backup\",\n  date: true\n});\n\nmodule.exports = {\n  backup: function(options, callback) {\n    var e, err;\n    if (callback == null) {\n      callback = function() {};\n    }\n    if (this.get('inBackup')) {\n      return callback(null);\n    }\n    options = options || {\n      force: false\n    };\n    if (!this.config.has('checkpointed')) {\n      err = new Error(\"Database not initialized before realtime\");\n      if (options.background) {\n        callback(err);\n      } else {\n        log.warn(err);\n        if (confirm(t('Database not initialized. Do it now ?'))) {\n          app.router.navigate('first-sync', {\n            trigger: true\n          });\n        }\n      }\n      return;\n    }\n    try {\n      this.set('inBackup', true);\n      this.set('backup_step', null);\n      this.stopRealtime();\n      return this._backup(options.force, (function(_this) {\n        return function(err) {\n          _this.set('backup_step', null);\n          _this.set('backup_step_done', null);\n          _this.set('inBackup', false);\n          if (!options.background) {\n            _this.startRealtime();\n          }\n          if (err) {\n            return callback(err);\n          }\n          return _this.config.save({\n            lastBackup: new Date().toString()\n          }, function(err) {\n            log.info(\"Backup done.\");\n            return callback(null);\n          });\n        };\n      })(this));\n    } catch (_error) {\n      e = _error;\n      return log.error(\"Error in backup: \", e);\n    }\n  },\n  _backup: function(force, callback) {\n    return DeviceStatus.checkReadyForSync((function(_this) {\n      return function(err, ready, msg) {\n        var errors;\n        log.info(\"SYNC STATUS\", err, ready, msg);\n        if (err) {\n          return callback(err);\n        }\n        if (!ready) {\n          return callback(new Error(msg));\n        }\n        log.info(\"WE ARE READY FOR SYNC\");\n        errors = [];\n        return async.series([\n          function(cb) {\n            return _this.syncPictures(force, function(err) {\n              if (err) {\n                log.error(\"in syncPictures: \", err);\n                errors.push(err);\n              }\n              return cb();\n            });\n          }, function(cb) {\n            return DeviceStatus.checkReadyForSync(function(err, ready, msg) {\n              if (!(ready || err)) {\n                err = new Error(msg);\n              }\n              if (err) {\n                return cb(err);\n              }\n              return _this.syncCache(function(err) {\n                if (err) {\n                  log.error(\"in syncCache\", err);\n                  errors.push(err);\n                }\n                return cb();\n              });\n            });\n          }, function(cb) {\n            return DeviceStatus.checkReadyForSync(function(err, ready, msg) {\n              if (!(ready || err)) {\n                err = new Error(msg);\n              }\n              if (err) {\n                resultsrn(cb(err));\n              }\n              return _this.syncContacts(function(err) {\n                if (err) {\n                  log.error(\"in syncContacts\", err);\n                  errors.push(err);\n                }\n                return cb();\n              });\n            });\n          }\n        ], function(err) {\n          if (err) {\n            return callback(err);\n          }\n          if (errors.length > 0) {\n            return callback(errors[0]);\n          } else {\n            return callback();\n          }\n        });\n      };\n    })(this));\n  },\n  syncPictures: function(force, callback) {\n    if (!this.config.get('syncImages')) {\n      return callback(null);\n    }\n    log.info(\"sync pictures\");\n    this.set('backup_step', 'pictures_scan');\n    this.set('backup_step_done', null);\n    return async.series([\n      this.ensureDeviceFolder.bind(this), ImagesBrowser.getImagesList, (function(_this) {\n        return function(callback) {\n          return _this.photosDB.query('PhotosByLocalId', {}, callback);\n        };\n      })(this), (function(_this) {\n        return function(cb) {\n          return _this.db.query('FilesAndFolder', {\n            startkey: ['/' + t('photos')],\n            endkey: ['/' + t('photos'), {}]\n          }, cb);\n        };\n      })(this)\n    ], (function(_this) {\n      return function(err, results) {\n        var dbImages, dbPictures, device, images, myDownloadFolder, toUpload, _ref;\n        if (err) {\n          return callback(err);\n        }\n        device = results[0], images = results[1], (_ref = results[2], dbImages = _ref.rows), dbPictures = results[3];\n        dbImages = dbImages.map(function(row) {\n          return row.key;\n        });\n        dbPictures = dbPictures.rows.map(function(row) {\n          var _ref1;\n          return (_ref1 = row.key[1]) != null ? _ref1.slice(2) : void 0;\n        });\n        myDownloadFolder = _this.downloads.toURL().replace('file://', '');\n        toUpload = [];\n        images = images.filter(function(path) {\n          return (path != null) && path.indexOf('/DCIM/') !== -1;\n        });\n        if (images.length === 0) {\n          return callback(new Error('no images in DCIM'));\n        }\n        return async.eachSeries(images, function(path, cb) {\n          if (__indexOf.call(dbImages, path) >= 0) {\n            return cb();\n          } else {\n            return fs.getFileFromPath(path, function(err, file) {\n              var _ref1, _ref2;\n              if (err) {\n                return cb(err);\n              }\n              if (_ref1 = (_ref2 = file.name) != null ? _ref2.toLowerCase() : void 0, __indexOf.call(dbPictures, _ref1) >= 0) {\n                _this.createPhoto(path);\n              } else {\n                toUpload.push(path);\n              }\n              return DeviceStatus.checkReadyForSync(function(err, ready, msg) {\n                if (err) {\n                  return cb(err);\n                }\n                if (!ready) {\n                  return cb(new Error(msg));\n                }\n                return setImmediate(cb);\n              });\n            });\n          }\n        }, function() {\n          var processed;\n          log.info(\"SYNC IMAGES : \" + images.length + \" \" + toUpload.length);\n          processed = 0;\n          _this.set('backup_step', 'pictures_sync');\n          _this.set('backup_step_total', toUpload.length);\n          return async.eachSeries(toUpload, function(path, cb) {\n            _this.set('backup_step_done', processed++);\n            log.info(\"UPLOADING \" + path);\n            return _this.uploadPicture(path, device, function(err) {\n              if (err) {\n                log.error(\"ERROR \" + path + \" \" + err);\n              }\n              if (DeviceStatus.readyForSync) {\n                return setImmediate(cb);\n              } else {\n                return cb(DeviceStatus.readyForSyncMsg);\n              }\n            });\n          }, callback);\n        });\n      };\n    })(this));\n  },\n  uploadPicture: function(path, device, callback) {\n    return fs.getFileFromPath(path, (function(_this) {\n      return function(err, file) {\n        if (err) {\n          return callback(err);\n        }\n        return fs.contentFromFile(file, function(err, content) {\n          if (err) {\n            return callback(err);\n          }\n          return _this.createBinary(content, file.type, function(err, bin) {\n            if (err) {\n              return callback(err);\n            }\n            return _this.createFile(file, path, bin, device, function(err, res) {\n              if (err) {\n                return callback(err);\n              }\n              return _this.createPhoto(path, callback);\n            });\n          });\n        });\n      };\n    })(this));\n  },\n  createBinary: function(blob, mime, callback) {\n    return this.config.remote.post({\n      docType: 'Binary'\n    }, (function(_this) {\n      return function(err, doc) {\n        if (err) {\n          return callback(err);\n        }\n        if (!doc.ok) {\n          return callback(new Error('cant create binary'));\n        }\n        return _this.config.remote.putAttachment(doc.id, 'file', doc.rev, blob, mime, function(err, doc) {\n          if (err) {\n            return callback(err);\n          }\n          if (!doc.ok) {\n            return callback(new Error('cant attach'));\n          }\n          return callback(null, doc);\n        });\n      };\n    })(this));\n  },\n  createFile: function(cordovaFile, localPath, binaryDoc, device, callback) {\n    var dbFile;\n    dbFile = {\n      docType: 'File',\n      localPath: localPath,\n      name: cordovaFile.name,\n      path: \"/\" + t('photos'),\n      \"class\": this.fileClassFromMime(cordovaFile.type),\n      lastModification: new Date(cordovaFile.lastModified).toISOString(),\n      creationDate: new Date(cordovaFile.lastModified).toISOString(),\n      size: cordovaFile.size,\n      tags: ['from-' + this.config.get('deviceName')],\n      binary: {\n        file: {\n          id: binaryDoc.id,\n          rev: binaryDoc.rev\n        }\n      }\n    };\n    return this.config.remote.post(dbFile, callback);\n  },\n  createPhoto: function(localPath, callback) {\n    var dbPhoto;\n    dbPhoto = {\n      docType: 'Photo',\n      localId: localPath\n    };\n    return this.photosDB.post(dbPhoto, callback);\n  },\n  fileClassFromMime: function(type) {\n    switch (type.split('/')[0]) {\n      case 'image':\n        return \"image\";\n      case 'audio':\n        return \"music\";\n      case 'video':\n        return \"video\";\n      case 'text':\n      case 'application':\n        return \"document\";\n      default:\n        return \"file\";\n    }\n  },\n  ensureDeviceFolder: function(callback) {\n    var createNew, findDevice;\n    findDevice = (function(_this) {\n      return function(id, callback) {\n        return _this.db.get(id, function(err, res) {\n          if (err == null) {\n            return callback();\n          } else {\n            return setTimeout((function() {\n              return findDevice(id, callback);\n            }), 200);\n          }\n        });\n      };\n    })(this);\n    createNew = (function(_this) {\n      return function() {\n        var folder, options;\n        log.info(\"creating 'photos' folder\");\n        folder = {\n          docType: 'Folder',\n          name: t('photos'),\n          path: '',\n          lastModification: new Date().toISOString(),\n          creationDate: new Date().toISOString(),\n          tags: []\n        };\n        options = {\n          key: ['', \"1_\" + (folder.name.toLowerCase())]\n        };\n        return _this.config.remote.post(folder, function(err, res) {\n          app.replicator.startRealtime();\n          return findDevice(res.id, function() {\n            if (err) {\n              return callback(err);\n            }\n            return callback(null, folder);\n          });\n        });\n      };\n    })(this);\n    return this.db.query('FilesAndFolder', {\n      key: ['', \"1_\" + (t('photos').toLowerCase())]\n    }, (function(_this) {\n      return function(err, results) {\n        var device, query;\n        if (err) {\n          return callback(err);\n        }\n        if (results.rows.length > 0) {\n          device = results.rows[0];\n          log.info(\"DEVICE FOLDER EXISTS\");\n          return callback(null, device);\n        } else {\n          query = '/_design/folder/_view/byfullpath/?' + (\"key=\\\"/\" + (t('photos')) + \"\\\"\");\n          return request.get(_this.config.makeUrl(query), function(err, res, body) {\n            var _ref;\n            if (err) {\n              return callback(err);\n            }\n            if ((body != null ? (_ref = body.rows) != null ? _ref.length : void 0 : void 0) === 0) {\n              return createNew();\n            } else {\n              return callback(new Error('photo folder not replicated yet'));\n            }\n          });\n        }\n      };\n    })(this));\n  }\n};\n","var APP_VERSION, ReplicatorConfig, basic,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nbasic = require('../lib/basic');\n\nAPP_VERSION = \"0.1.10\";\n\nmodule.exports = ReplicatorConfig = (function(_super) {\n  __extends(ReplicatorConfig, _super);\n\n  function ReplicatorConfig(replicator) {\n    this.replicator = replicator;\n    ReplicatorConfig.__super__.constructor.call(this, null);\n    this.remote = null;\n  }\n\n  ReplicatorConfig.prototype.defaults = function() {\n    return {\n      _id: 'localconfig',\n      syncContacts: true,\n      syncImages: true,\n      syncOnWifi: true,\n      cozyNotifications: true,\n      cozyURL: '',\n      deviceName: ''\n    };\n  };\n\n  ReplicatorConfig.prototype.fetch = function(callback) {\n    return this.replicator.db.get('localconfig', (function(_this) {\n      return function(err, config) {\n        if (config) {\n          _this.set(config);\n          _this.remote = _this.createRemotePouchInstance();\n        }\n        return callback(null, _this);\n      };\n    })(this));\n  };\n\n  ReplicatorConfig.prototype.save = function(changes, callback) {\n    this.set(changes);\n    return this.replicator.db.get('localconfig', (function(_this) {\n      return function(err, config) {\n        if (!err) {\n          _this.set({\n            _rev: config._rev\n          });\n        }\n        return _this.replicator.db.put(_this.toJSON(), function(err, res) {\n          if (err) {\n            return callback(err);\n          }\n          if (!res.ok) {\n            return callback(new Error('cant save config'));\n          }\n          _this.set({\n            _rev: res.rev\n          });\n          _this.remote = _this.createRemotePouchInstance();\n          return typeof callback === \"function\" ? callback(null, _this) : void 0;\n        });\n      };\n    })(this));\n  };\n\n  ReplicatorConfig.prototype.getScheme = function() {\n    if (window.isBrowserDebugging) {\n      return 'http';\n    } else {\n      return 'https';\n    }\n  };\n\n  ReplicatorConfig.prototype.makeUrl = function(path) {\n    return {\n      json: true,\n      auth: this.get('auth'),\n      url: (\"\" + (this.getScheme()) + \"://\") + this.get('cozyURL') + '/cozy' + path\n    };\n  };\n\n  ReplicatorConfig.prototype.makeFilterName = function() {\n    return this.get('deviceId') + '/filter';\n  };\n\n  ReplicatorConfig.prototype.createRemotePouchInstance = function() {\n    return new PouchDB({\n      name: this.get('fullRemoteURL')\n    });\n  };\n\n  ReplicatorConfig.prototype.appVersion = function() {\n    return APP_VERSION;\n  };\n\n  return ReplicatorConfig;\n\n})(Backbone.Model);\n","var ACCOUNT_NAME, ACCOUNT_TYPE, Contact, log, request;\n\nrequest = require('../lib/request');\n\nContact = require('../models/contact');\n\nACCOUNT_TYPE = 'io.cozy';\n\nACCOUNT_NAME = 'myCozy';\n\nlog = require('/lib/persistent_log')({\n  prefix: \"contacts replicator\",\n  date: true\n});\n\nmodule.exports = {\n  syncContacts: function(callback) {\n    if (!this.config.get('syncContacts')) {\n      return callback(null);\n    }\n    this.set('backup_step', 'contacts_sync');\n    this.set('backup_step_done', null);\n    return async.series([\n      (function(_this) {\n        return function(cb) {\n          if (_this.config.has('contactsPullCheckpointed')) {\n            return cb();\n          } else {\n            return request.get(_this.config.makeUrl('/_changes?descending=true&limit=1'), function(err, res, body) {\n              if (err) {\n                return cb(err);\n              }\n              return _this.initContactsInPhone(body.last_seq, cb);\n            });\n          }\n        };\n      })(this), (function(_this) {\n        return function(cb) {\n          return _this.syncPhone2Pouch(cb);\n        };\n      })(this), (function(_this) {\n        return function(cb) {\n          return _this.syncToCozy(cb);\n        };\n      })(this), (function(_this) {\n        return function(cb) {\n          return _this.syncFromCozyToPouchToPhone(cb);\n        };\n      })(this)\n    ], function(err) {\n      log.info(\"Sync contacts done\");\n      return callback(err);\n    });\n  },\n  createAccount: (function(_this) {\n    return function(callback) {\n      return navigator.contacts.createAccount(ACCOUNT_TYPE, ACCOUNT_NAME, function() {\n        return callback(null);\n      }, callback);\n    };\n  })(this),\n  _updateInPouch: function(phoneContact, callback) {\n    return async.parallel({\n      fromPouch: (function(_this) {\n        return function(cb) {\n          return _this.db.get(phoneContact.sourceId, {\n            attachments: true\n          }, cb);\n        };\n      })(this),\n      fromPhone: function(cb) {\n        return Contact.cordova2Cozy(phoneContact, cb);\n      }\n    }, (function(_this) {\n      return function(err, res) {\n        var contact, oldPicture, picture, _ref, _ref1, _ref2;\n        if (err) {\n          return callback(err);\n        }\n        contact = _.extend(res.fromPouch, res.fromPhone);\n        if (((_ref = contact._attachments) != null ? _ref.picture : void 0) != null) {\n          picture = contact._attachments.picture;\n          if (((_ref1 = res.fromPouch._attachments) != null ? _ref1.picture : void 0) != null) {\n            oldPicture = ((_ref2 = res.fromPouch._attachments) != null ? _ref2.picture : void 0) != null;\n            if (oldPicture.data === picture.data) {\n              picture.revpos = oldPicture.revpos;\n            } else {\n              picture.revpos = 1 + parseInt(contact._rev.split('-')[0]);\n            }\n          }\n        }\n        return _this.db.put(contact, contact._id, contact._rev, function(err, idNrev) {\n          if (err) {\n            if (err.status === 409) {\n              log.error(\"UpdateInPouch, immediate conflict with \" + contact._id + \".\", err);\n              return callback(null);\n            } else if (err.message === \"Some query argument is invalid\") {\n              log.error(\"While retrying update contact in pouch\", err);\n              return callback(null);\n            } else {\n              return callback(err);\n            }\n          }\n          return _this._undirty(phoneContact, idNrev, callback);\n        });\n      };\n    })(this));\n  },\n  _createInPouch: function(phoneContact, callback) {\n    return Contact.cordova2Cozy(phoneContact, (function(_this) {\n      return function(err, fromPhone) {\n        var contact, _ref;\n        contact = _.extend({\n          docType: 'contact',\n          tags: []\n        }, fromPhone);\n        if (((_ref = contact._attachments) != null ? _ref.picture : void 0) != null) {\n          contact._attachments.picture.revpos = 1;\n        }\n        return _this.db.post(contact, function(err, idNrev) {\n          if (err) {\n            if (err.message === \"Some query argument is invalid\") {\n              log.error(\"While retrying create contact in pouch\", err);\n              return callback(null);\n            } else {\n              return callback(err);\n            }\n          }\n          return _this._undirty(phoneContact, idNrev, callback);\n        });\n      };\n    })(this));\n  },\n  _undirty: function(dirtyContact, idNrev, callback) {\n    dirtyContact.dirty = false;\n    dirtyContact.sourceId = idNrev.id;\n    dirtyContact.sync2 = idNrev.rev;\n    return dirtyContact.save(function() {\n      return callback(null);\n    }, callback, {\n      accountType: ACCOUNT_TYPE,\n      accountName: ACCOUNT_NAME,\n      callerIsSyncAdapter: true\n    });\n  },\n  _deleteInPouch: function(phoneContact, callback) {\n    var toDelete;\n    toDelete = {\n      docType: 'contact',\n      _id: phoneContact.sourceId,\n      _rev: phoneContact.sync2,\n      _deleted: true\n    };\n    return this.db.put(toDelete, toDelete._id, toDelete._rev, (function(_this) {\n      return function(err, res) {\n        return phoneContact.remove((function() {\n          return callback();\n        }), callback, {\n          callerIsSyncAdapter: true\n        });\n      };\n    })(this));\n  },\n  syncPhone2Pouch: function(callback) {\n    log.info(\"enter syncPhone2Pouch\");\n    return navigator.contacts.find([navigator.contacts.fieldType.dirty], (function(_this) {\n      return function(contacts) {\n        var processed;\n        processed = 0;\n        _this.set('backup_step', 'contacts_sync_to_pouch');\n        _this.set('backup_step_total', contacts.length);\n        log.info(\"syncPhone2Pouch \" + contacts.length + \" contacts.\");\n        return async.eachSeries(contacts, function(contact, cb) {\n          _this.set('backup_step_done', processed++);\n          return setImmediate(function() {\n            if (contact.deleted) {\n              return _this._deleteInPouch(contact, cb);\n            } else if (contact.sourceId) {\n              return _this._updateInPouch(contact, cb);\n            } else {\n              return _this._createInPouch(contact, cb);\n            }\n          });\n        }, callback);\n      };\n    })(this), callback, new ContactFindOptions(\"1\", true, [], ACCOUNT_TYPE, ACCOUNT_NAME));\n  },\n  syncToCozy: function(callback) {\n    var replication;\n    log.info(\"enter sync2Cozy\");\n    this.set('backup_step_done', null);\n    this.set('backup_step', 'contacts_sync_to_cozy');\n    replication = this.db.replicate.to(this.config.remote, {\n      batch_size: 20,\n      batches_limit: 5,\n      filter: function(doc) {\n        var _ref;\n        return (doc != null) && ((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'contact';\n      },\n      live: false,\n      since: this.config.get('contactsPushCheckpointed')\n    });\n    replication.on('error', callback);\n    return replication.on('complete', (function(_this) {\n      return function(result) {\n        return _this.config.save({\n          contactsPushCheckpointed: result.last_seq\n        }, callback);\n      };\n    })(this));\n  },\n  _saveContactInPhone: function(cozyContact, phoneContact, callback) {\n    var options, toSaveInPhone;\n    toSaveInPhone = Contact.cozy2Cordova(cozyContact);\n    if (phoneContact) {\n      toSaveInPhone.id = phoneContact.id;\n      toSaveInPhone.rawId = phoneContact.rawId;\n    }\n    options = {\n      accountType: ACCOUNT_TYPE,\n      accountName: ACCOUNT_NAME,\n      callerIsSyncAdapter: true,\n      resetFields: true\n    };\n    return toSaveInPhone.save(function(contact) {\n      return callback(null, contact);\n    }, callback, options);\n  },\n  _applyChangeToPhone: function(docs, callback) {\n    var getFromPhoneBySourceId;\n    getFromPhoneBySourceId = function(sourceId, cb) {\n      return navigator.contacts.find([navigator.contacts.fieldType.sourceId], function(contacts) {\n        return cb(null, contacts[0]);\n      }, cb, new ContactFindOptions(sourceId, false, [], ACCOUNT_TYPE, ACCOUNT_NAME));\n    };\n    return async.eachSeries(docs, (function(_this) {\n      return function(doc, cb) {\n        _this.set('backup_step_done', _this.get('backup_step_done') + 1);\n        return getFromPhoneBySourceId(doc._id, function(err, contact) {\n          if (err) {\n            return cb(err);\n          }\n          if (doc._deleted) {\n            if (contact != null) {\n              return contact.remove((function() {\n                return cb();\n              }), cb, {\n                callerIsSyncAdapter: true\n              });\n            }\n          } else {\n            return _this._saveContactInPhone(doc, contact, cb);\n          }\n        });\n      };\n    })(this), function(err) {\n      return callback(err);\n    });\n  },\n  syncFromCozyToPouchToPhone: function(callback) {\n    var applyToPhoneQueue, replication, replicationDone, total;\n    log.info(\"enter syncCozy2Phone\");\n    replicationDone = false;\n    total = 0;\n    this.set('backup_step', 'contacts_sync_to_phone');\n    this.set('backup_step_done', 0);\n    applyToPhoneQueue = async.queue(this._applyChangeToPhone.bind(this));\n    applyToPhoneQueue.drain = function() {\n      if (replicationDone) {\n        return callback();\n      }\n    };\n    replication = this.db.replicate.from(this.config.remote, {\n      batch_size: 20,\n      batches_limit: 1,\n      filter: function(doc) {\n        var _ref;\n        return (doc != null) && ((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'contact';\n      },\n      live: false,\n      since: this.config.get('contactsPullCheckpointed')\n    });\n    replication.on('change', (function(_this) {\n      return function(changes) {\n        var _ref;\n        applyToPhoneQueue.push($.extend(true, {}, changes.docs));\n        total += (_ref = changes.docs) != null ? _ref.length : void 0;\n        _this.set('backup_step_total', total);\n        return log.info(\"sync2Phone \" + total + \" contacts.\");\n      };\n    })(this));\n    replication.on('error', callback);\n    return replication.on('complete', (function(_this) {\n      return function(result) {\n        return _this.config.save({\n          contactsPullCheckpointed: result.last_seq\n        }, function() {\n          replicationDone = true;\n          if (applyToPhoneQueue.idle()) {\n            applyToPhoneQueue.drain = null;\n            return callback();\n          }\n        });\n      };\n    })(this));\n  },\n  initContactsInPhone: function(lastSeq, callback) {\n    if (!this.config.get('syncContacts')) {\n      return callback();\n    }\n    return this.createAccount((function(_this) {\n      return function(err) {\n        return request.get(_this.config.makeUrl(\"/_design/contact/_view/all/\"), function(err, res, body) {\n          var _ref;\n          if (err) {\n            return callback(err);\n          }\n          if (!((_ref = body.rows) != null ? _ref.length : void 0)) {\n            return callback(null);\n          }\n          return async.mapSeries(body.rows, function(row, cb) {\n            var doc, _ref1;\n            doc = row.value;\n            if (((_ref1 = doc._attachments) != null ? _ref1.picture : void 0) != null) {\n              return request.get(_this.config.makeUrl(\"/\" + doc._id + \"?attachments=true\"), function(err, res, body) {\n                if (err) {\n                  return cb(err);\n                }\n                return cb(null, body);\n              });\n            } else {\n              return cb(null, doc);\n            }\n          }, function(err, docs) {\n            if (err) {\n              return callback(err);\n            }\n            return async.mapSeries(docs, function(doc, cb) {\n              return _this.db.put(doc, {\n                'new_edits': false\n              }, cb);\n            }, function(err, contacts) {\n              if (err) {\n                return callback(err);\n              }\n              _this.set('backup_step', null);\n              return _this._applyChangeToPhone(docs, function(err) {\n                _this.set('backup_step_done', null);\n                return _this.config.save({\n                  contactsPullCheckpointed: lastSeq\n                }, function(err) {\n                  return _this.deleteObsoletePhoneContacts(callback);\n                });\n              });\n            });\n          });\n        });\n      };\n    })(this));\n  },\n  deleteObsoletePhoneContacts: function(callback) {\n    log.info(\"enter deleteObsoletePhoneContacts\");\n    return async.parallel({\n      phone: function(cb) {\n        return navigator.contacts.find([navigator.contacts.fieldType.id], function(contacts) {\n          return cb(null, contacts);\n        }, cb, new ContactFindOptions(\"\", true, [], ACCOUNT_TYPE, ACCOUNT_NAME));\n      },\n      pouch: (function(_this) {\n        return function(cb) {\n          return _this.db.query(\"Contacts\", {}, cb);\n        };\n      })(this)\n    }, (function(_this) {\n      return function(err, contacts) {\n        var idsInPouch, row, _i, _len, _ref;\n        if (err) {\n          return callback(err);\n        }\n        idsInPouch = {};\n        _ref = contacts.pouch.rows;\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          row = _ref[_i];\n          idsInPouch[row.id] = true;\n        }\n        return async.eachSeries(contacts.phone, function(contact, cb) {\n          if (!(contact.sourceId in idsInPouch)) {\n            log.info(\"Delete contact: \" + contact.sourceId);\n            return contact.remove((function() {\n              return cb();\n            }), cb, {\n              callerIsSyncAdapter: true\n            });\n          }\n          return cb();\n        }, callback);\n      };\n    })(this));\n  }\n};\n","var ByBinaryIdDesignDoc, ContactsDesignDoc, DevicesByLocalIdDesignDoc, FilesAndFolderDesignDoc, LocalPathDesignDoc, NotificationsTemporaryDesignDoc, PathToBinaryDesignDoc, PhotosByLocalIdDesignDoc, PicturesDesignDoc, createOrUpdateDesign, log;\n\nlog = require('/lib/persistent_log')({\n  prefix: \"replicator mapreduce\",\n  date: true\n});\n\ncreateOrUpdateDesign = function(db, design, callback) {\n  return db.get(design._id, (function(_this) {\n    return function(err, existing) {\n      if ((existing != null ? existing.version : void 0) === design.version) {\n        return callback(null);\n      } else {\n        log.info(\"REDEFINING DESIGN \" + design._id + \" FROM \" + existing);\n        if (existing) {\n          design._rev = existing._rev;\n        }\n        return db.put(design, callback);\n      }\n    };\n  })(this));\n};\n\nPathToBinaryDesignDoc = {\n  _id: '_design/PathToBinary',\n  version: 1,\n  views: {\n    'PathToBinary': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1, _ref2;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n          return emit(doc.path + '/' + doc.name, (_ref1 = doc.binary) != null ? (_ref2 = _ref1.file) != null ? _ref2.id : void 0 : void 0);\n        }\n      })\n    }\n  }\n};\n\nFilesAndFolderDesignDoc = {\n  _id: '_design/FilesAndFolder',\n  version: 1,\n  views: {\n    'FilesAndFolder': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1;\n        if (doc.name != null) {\n          if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n            emit([doc.path, '2_' + doc.name.toLowerCase()]);\n          }\n          if (((_ref1 = doc.docType) != null ? _ref1.toLowerCase() : void 0) === 'folder') {\n            return emit([doc.path, '1_' + doc.name.toLowerCase()]);\n          }\n        }\n      })\n    }\n  }\n};\n\nByBinaryIdDesignDoc = {\n  _id: '_design/ByBinaryId',\n  version: 1,\n  views: {\n    'ByBinaryId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref, _ref1, _ref2;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n          return emit((_ref1 = doc.binary) != null ? (_ref2 = _ref1.file) != null ? _ref2.id : void 0 : void 0);\n        }\n      })\n    }\n  }\n};\n\nPicturesDesignDoc = {\n  _id: '_design/Pictures',\n  version: 1,\n  views: {\n    'Pictures': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (doc.lastModification != null) {\n          if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'file') {\n            return emit([doc.path, doc.lastModification]);\n          }\n        }\n      })\n    }\n  }\n};\n\nNotificationsTemporaryDesignDoc = {\n  _id: '_design/NotificationsTemporary',\n  version: 1,\n  views: {\n    'NotificationsTemporary': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'notification' && doc.type === 'temporary') {\n          return emit(doc._id);\n        }\n      })\n    }\n  }\n};\n\nLocalPathDesignDoc = {\n  _id: '_design/LocalPath',\n  version: 1,\n  views: {\n    'LocalPath': {\n      map: Object.toString.apply(function(doc) {\n        if (doc.localPath) {\n          return emit(doc.localPath);\n        }\n      })\n    }\n  }\n};\n\nContactsDesignDoc = {\n  _id: '_design/Contacts',\n  version: 1,\n  views: {\n    'Contacts': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'contact') {\n          return emit(doc._id);\n        }\n      })\n    }\n  }\n};\n\nPhotosByLocalIdDesignDoc = {\n  _id: '_design/PhotosByLocalId',\n  version: 1,\n  views: {\n    'PhotosByLocalId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'photo') {\n          return emit(doc.localId);\n        }\n      })\n    }\n  }\n};\n\nDevicesByLocalIdDesignDoc = {\n  _id: '_design/DevicesByLocalId',\n  version: 2,\n  views: {\n    'DevicesByLocalId': {\n      map: Object.toString.apply(function(doc) {\n        var _ref;\n        if (((_ref = doc.docType) != null ? _ref.toLowerCase() : void 0) === 'device') {\n          return emit(doc.localId, doc);\n        }\n      })\n    }\n  }\n};\n\nmodule.exports = function(db, photosDB, callback) {\n  return async.series([\n    function(cb) {\n      return createOrUpdateDesign(db, NotificationsTemporaryDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, FilesAndFolderDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, ByBinaryIdDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, PicturesDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, LocalPathDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, PathToBinaryDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(db, ContactsDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(photosDB, PhotosByLocalIdDesignDoc, cb);\n    }, function(cb) {\n      return createOrUpdateDesign(photosDB, DevicesByLocalIdDesignDoc, cb);\n    }\n  ], callback);\n};\n","var ConfigView, DeviceNamePickerView, FirstSyncView, FolderCollection, FolderView, LoginView, Router, app, log,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\napp = require('application');\n\nFolderView = require('./views/folder');\n\nLoginView = require('./views/login');\n\nDeviceNamePickerView = require('./views/device_name_picker');\n\nFirstSyncView = require('./views/first_sync');\n\nConfigView = require('./views/config');\n\nFolderCollection = require('./collections/files');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"replicator\",\n  date: true\n});\n\nmodule.exports = Router = (function(_super) {\n  __extends(Router, _super);\n\n  function Router() {\n    return Router.__super__.constructor.apply(this, arguments);\n  }\n\n  Router.prototype.routes = {\n    'folder/*path': 'folder',\n    'search/*query': 'search',\n    'login': 'login',\n    'device-name-picker': 'deviceNamePicker',\n    'first-sync': 'firstSync',\n    'config': 'config'\n  };\n\n  Router.prototype.folder = function(path) {\n    var collection;\n    $('#btn-menu').show();\n    $('#btn-back').hide();\n    app.layout.setBreadcrumbs(path);\n    collection = new FolderCollection([], {\n      path: path\n    });\n    this.display(new FolderView({\n      collection: collection\n    }, collection.fetch()));\n    return collection.once('fullsync', (function(_this) {\n      return function() {\n        return _this.trigger('collectionfetched');\n      };\n    })(this));\n  };\n\n  Router.prototype.search = function(query) {\n    var collection;\n    $('#btn-menu').show();\n    $('#btn-back').hide();\n    app.layout.setBackButton('#folder/', 'home');\n    app.layout.setTitle(t('search') + ' \"' + query + '\"');\n    collection = new FolderCollection([], {\n      query: query\n    });\n    this.display(new FolderView({\n      collection: collection\n    }));\n    return collection.search((function(_this) {\n      return function(err) {\n        if (err) {\n          log.error(err.stack);\n          return alert(err);\n        }\n        return $('#search-input').blur();\n      };\n    })(this));\n  };\n\n  Router.prototype.login = function() {\n    app.layout.setTitle(t('setup 1/3'));\n    $('#btn-menu, #btn-back').hide();\n    return this.display(new LoginView());\n  };\n\n  Router.prototype.deviceNamePicker = function() {\n    app.layout.setTitle(t('setup 2/3'));\n    return this.display(new DeviceNamePickerView());\n  };\n\n  Router.prototype.firstSync = function() {\n    app.layout.setTitle(t('setup end'));\n    return this.display(new FirstSyncView());\n  };\n\n  Router.prototype.config = function() {\n    var titleKey;\n    $('#btn-back').hide();\n    titleKey = app.isFirstRun ? 'setup 3/3' : 'config';\n    app.layout.setTitle(t(titleKey));\n    return this.display(new ConfigView());\n  };\n\n  Router.prototype.display = function(view) {\n    return app.layout.transitionTo(view);\n  };\n\n  Router.prototype.forceRefresh = function() {\n    var col, path, _ref;\n    col = (_ref = app.layout.currentView) != null ? _ref.collection : void 0;\n    if ((col != null ? col.path : void 0) === null) {\n      path = '';\n    } else if ((col != null ? col.path : void 0) !== void 0) {\n      path = col.path;\n    } else {\n      return;\n    }\n    delete FolderCollection.cache[path];\n    return col.fetch();\n  };\n\n  return Router;\n\n})(Backbone.Router);\n","var DeviceStatus, Notifications, Replicator, Service, log;\n\nrequire('/lib/utils');\n\nReplicator = require('../replicator/main');\n\nNotifications = require('../views/notifications');\n\nDeviceStatus = require('../lib/device_status');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"application\",\n  date: true,\n  processusTag: \"Service\"\n});\n\nmodule.exports = Service = {\n  initialize: function() {\n    window.app = this;\n    if (window.isBrowserDebugging) {\n      window.navigator = window.navigator || {};\n      window.navigator.globalization = window.navigator.globalization || {};\n      window.navigator.globalization.getPreferredLanguage = function(callback) {\n        return callback({\n          value: 'fr-FR'\n        });\n      };\n    }\n    return navigator.globalization.getPreferredLanguage((function(_this) {\n      return function(properties) {\n        var e, locales;\n        _this.locale = properties.value.split('-')[0];\n        _this.polyglot = new Polyglot();\n        locales = (function() {\n          try {\n            return require('locales/' + this.locale);\n          } catch (_error) {\n            e = _error;\n            return require('locales/en');\n          }\n        }).call(_this);\n        _this.polyglot.extend(locales);\n        window.t = _this.polyglot.t.bind(_this.polyglot);\n        _this.replicator = new Replicator();\n        return _this.replicator.init(function(err, config) {\n          var delayedQuit;\n          if (err) {\n            log.error(err);\n            return window.service.workDone();\n          }\n          if (config.remote) {\n            if (!_this.replicator.config.has('checkpointed')) {\n              log.error(new Error(\"Database not initialized\"));\n              return window.service.workDone();\n            }\n            DeviceStatus.initialize();\n            if (config.get('cozyNotifications')) {\n              _this.notificationManager = new Notifications();\n            }\n            delayedQuit = function(err) {\n              if (err) {\n                log.error(err);\n              }\n              return setTimeout(function() {\n                return window.service.workDone();\n              }, 5 * 1000);\n            };\n            return app.replicator.backup({\n              background: true\n            }, function(err) {\n              if (err) {\n                log.error(\"Error launching backup: \", err);\n                return delayedQuit();\n              } else {\n                return app.replicator.sync({\n                  background: true\n                }, delayedQuit);\n              }\n            });\n          } else {\n            return window.service.workDone();\n          }\n        });\n      };\n    })(this));\n  }\n};\n\ndocument.addEventListener('deviceready', function() {\n  var error;\n  try {\n    return Service.initialize();\n  } catch (_error) {\n    error = _error;\n    return log.error('EXCEPTION SERVICE INITIALIZATION : ', err);\n  } finally {\n    setTimeout(function() {\n      return window.service.workDone();\n    }, 10 * 60 * 1000);\n  }\n});\n","var ServiceManager, log, repeatingPeriod,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nlog = require('/lib/persistent_log')({\n  prefix: \"ServiceManager\",\n  date: true\n});\n\nrepeatingPeriod = 15 * 60 * 1000;\n\nmodule.exports = ServiceManager = (function(_super) {\n  __extends(ServiceManager, _super);\n\n  function ServiceManager() {\n    return ServiceManager.__super__.constructor.apply(this, arguments);\n  }\n\n  ServiceManager.prototype.defaults = function() {\n    return {\n      daemonActivated: false\n    };\n  };\n\n  ServiceManager.prototype.initialize = function() {\n    var config;\n    config = app.replicator.config;\n    this.listenNewPictures(config, config.get('syncImages'));\n    this.toggle(config, true);\n    this.listenTo(app.replicator.config, \"change:syncImages\", this.listenNewPictures);\n    return this.checkActivated();\n  };\n\n  ServiceManager.prototype.isActivated = function() {\n    return this.get('daemonActivated');\n  };\n\n  ServiceManager.prototype.checkActivated = function() {\n    return window.JSBackgroundService.isRepeating((function(_this) {\n      return function(err, isRepeating) {\n        if (err) {\n          log.error(err);\n          isRepeating = false;\n        }\n        return _this.set('daemonActivated', isRepeating);\n      };\n    })(this));\n  };\n\n  ServiceManager.prototype.activate = function(repeatingPeriod) {\n    return window.JSBackgroundService.setRepeating(repeatingPeriod, (function(_this) {\n      return function(err) {\n        if (err) {\n          return console.log(err);\n        }\n        return _this.checkActivated();\n      };\n    })(this));\n  };\n\n  ServiceManager.prototype.deactivate = function() {\n    return window.JSBackgroundService.cancelRepeating((function(_this) {\n      return function(err) {\n        if (err) {\n          return console.log(err);\n        }\n        return _this.checkActivated();\n      };\n    })(this));\n  };\n\n  ServiceManager.prototype.toggle = function(config, activate) {\n    if (activate) {\n      return this.activate();\n    } else {\n      return this.deactivate();\n    }\n  };\n\n  ServiceManager.prototype.listenNewPictures = function(config, listen) {\n    return window.JSBackgroundService.listenNewPictures(listen, function(err) {\n      if (err) {\n        return console.log(err);\n      }\n    });\n  };\n\n  return ServiceManager;\n\n})(Backbone.Model);\n","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<a href=\"#folder/\" class=\"home\"><div class=\"span\">');\nvar __val__ = t('files')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div style=\"display: none;\" class=\"arrow\"><div class=\"blue-arrow\"></div><div class=\"white-arrow\"></div></div></a><div id=\"crumbs\"><ul></ul></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<li><a');\nbuf.push(attrs({ 'href':(\"#folder\" + (model.path) + \"\") }, {\"href\":true}));\nbuf.push('>' + escape((interp = model.name) == null ? '' : interp) + '</a></li>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div class=\"item item-divider\">');\nvar __val__ = t('phone2cozy title')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item item-checkbox\">');\nvar __val__ = t('contacts sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('contactSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncContacts) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div><div class=\"item item-checkbox\">');\nvar __val__ = t('images sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('imageSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncImages) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div><div class=\"item item-checkbox\">');\nvar __val__ = t('wifi sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('wifiSyncCheck'), 'type':(\"checkbox\"), 'checked':(syncOnWifi) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div><div class=\"item item-checkbox\">');\nvar __val__ = t('cozy notifications sync label')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<label class=\"checkbox\"><input');\nbuf.push(attrs({ 'id':('cozyNotificationsCheck'), 'type':(\"checkbox\"), 'checked':(cozyNotifications) }, {\"type\":true,\"checked\":true}));\nbuf.push('/></label></div>');\nif ( firstRun)\n{\nbuf.push('<div class=\"item\"><button id=\"configDone\" class=\"button button-block button-balanced\">');\nvar __val__ = t('next')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div>');\n}\nelse\n{\nbuf.push('<div id=\"doBackup\" class=\"item item-icon\"><div class=\"icon-backup\"></div><span class=\"text\">');\nvar __val__ = t('last backup')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('&nbsp;' + escape((interp = lastBackup) == null ? '' : interp) + '.</span></div><div class=\"item item-divider\">');\nvar __val__ = t('about')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('synchronized with') + \" \" + cozyURL\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('device name') + ' : ' + deviceName\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\">');\nvar __val__ = t('app name') + ' v' + appVersion\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item item-divider\">');\nvar __val__ = t('reset title')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\"><p>');\nvar __val__ = t('synchro warning')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</p><button id=\"synchrobtn\" class=\"button button-grey button-full-width\">');\nvar __val__ = t('retry synchro')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div><div class=\"item\"><p>');\nvar __val__ = t('reset warning')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</p><button id=\"redbtn\" class=\"button button-energized button-full-width\">');\nvar __val__ = t('reset action')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div><div class=\"item item-divider\">');\nvar __val__ = t('support')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div><div class=\"item\"><p>');\nvar __val__ = t('send log info')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</p><button id=\"sendlogbtn\" class=\"button button-grey button-full-width\">');\nvar __val__ = t('send log')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"deviceNamePicker\" class=\"list\"><div class=\"card no-shadow more-spacing flat\"><div class=\"item item-text-wrap\">');\nvar __val__ = t('device name explanation')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div></div><div class=\"card no-shadow more-spacing\"><label><input');\nbuf.push(attrs({ 'id':('input-device'), 'type':(\"text\"), 'value':(\"\" + (t('device name placeholder')) + \"\") }, {\"type\":true,\"value\":true}));\nbuf.push('/></label><div class=\"button-bar\"><button id=\"btn-back\" class=\"button button-dark button-clear\">');\nvar __val__ = t('back')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button><button id=\"btn-save\" class=\"button button-balanced\">');\nvar __val__ = t('next')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div id=\"finishSync\" class=\"card no-shadow more-spacing flat\"><div class=\"progress item item-text-wrap\">');\nvar __val__ = messageText\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div></div><div class=\"card no-shadow more-spacing\"><button id=\"btn-end\" class=\"button button-block button-balanced\">');\nvar __val__ = buttonText\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"item-content\">');\nif ( isFolder)\n{\nbuf.push('<i class=\"icon icon-type type-folder\"></i>');\n}\nelse\n{\nbuf.push('<i');\nbuf.push(attrs({ \"class\": (\"icon icon-type \" + (this.mimeClasses[model.mime]) + \"\") }, {\"class\":true}));\nbuf.push('></i>');\n}\nbuf.push('<span>');\nvar __val__ = model.name\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span>');\nif ( isFolder)\n{\nbuf.push('<i class=\"cache-indicator icon icon-download\"></i>');\n}\nelse if ( model.incache && model.version)\n{\nbuf.push('<i class=\"cache-indicator icon icon-phone\"></i>');\n}\nelse if ( model.incache)\n{\nbuf.push('<i class=\"cache-indicator-version icon icon-phone\"></i>');\n}\nelse\n{\nbuf.push('<i class=\"cache-indicator icon icon-download\"></i>');\n}\nbuf.push('</div><div class=\"item-options invisible\">');\nif ( model.incache == 'loading')\n{\nbuf.push('<div class=\"button\">');\nvar __val__ = t('loading')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nelse if ( model.incache)\n{\nbuf.push('<div class=\"button uncache\">');\nvar __val__ = t('remove local')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nelse\n{\nbuf.push('<div class=\"button download\">');\nvar __val__ = t('download')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</div>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"container\" class=\"pane\"><div id=\"bar-header\" class=\"bar bar-header\"><a id=\"btn-menu\" class=\"btn-menu\"></a><div id=\"icon-logo\" class=\"icon-logo\"></div><h1 id=\"title\" class=\"title\">Loading</h1><div id=\"breadcrumbs\"></div><a id=\"headerSpinner\" class=\"spinner\"><img src=\"img/spinner.svg\"/></a></div><div class=\"bar bar-subheader bar-calm\"><h2 id=\"backupIndicator\" class=\"title\"></h2></div><div id=\"viewsPlaceholder\" class=\"scroll-content has-header\"><div class=\"scroll\"></div></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"list\"><div class=\"card no-shadow more-spacing flat\"><div class=\"item item-text-wrap\"><h2 class=\"welcome\"></h2><p class=\"welcome-message\"></p></div></div><div class=\"card no-shadow more-spacing\"><label><input');\nbuf.push(attrs({ 'id':('input-url'), 'type':(\"url\"), 'placeholder':(\"\" + (t('url placeholder')) + \"\"), 'value':(\"\" + (defaultValue.cozyURL) + \"\") }, {\"type\":true,\"placeholder\":true,\"value\":true}));\nbuf.push('/></label><label><input');\nbuf.push(attrs({ 'id':('input-pass'), 'type':(\"password\"), 'placeholder':(\"\" + (t('password placeholder')) + \"\"), 'value':(\"\" + (defaultValue.password) + \"\") }, {\"type\":true,\"placeholder\":true,\"value\":true}));\nbuf.push('/></label><button id=\"btn-save\" class=\"button button-block button-balanced\">');\nvar __val__ = t('next')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</button></div><div class=\"card no-shadow more-spacing\"><div class=\"item item-text-wrap\"><p class=\"no-account\"></p></div></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"content\"><div class=\"item item-input-inset\"><label class=\"item-input-wrapper\"><input');\nbuf.push(attrs({ 'id':('search-input'), 'type':(\"text\"), 'placeholder':(t(\"search\")) }, {\"type\":true,\"placeholder\":true}));\nbuf.push('/></label><a id=\"btn-search\" class=\"btn-search\"></a></div><a href=\"#folder/\" class=\"item icon-folder\">');\nvar __val__ = t('files')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a><a href=\"#config\" class=\"item icon-cog\">');\nvar __val__ = t('config')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a><a id=\"syncButton\" class=\"item icon-sync\">');\nvar __val__ = t('sync')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</a></div>');\n}\nreturn buf.join(\"\");\n};","var BaseView, BreadcrumbsView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = BreadcrumbsView = (function(_super) {\n  __extends(BreadcrumbsView, _super);\n\n  function BreadcrumbsView() {\n    return BreadcrumbsView.__super__.constructor.apply(this, arguments);\n  }\n\n  BreadcrumbsView.prototype.id = 'breadcrumbs';\n\n  BreadcrumbsView.prototype.template = require('../templates/breadcrumbs');\n\n  BreadcrumbsView.prototype.itemview = require('../templates/breadcrumbs_element');\n\n  BreadcrumbsView.prototype.events = {\n    'click #truncated': 'scrollRight'\n  };\n\n  BreadcrumbsView.prototype.initialize = function(options) {\n    var reduction;\n    if (options.path == null) {\n      return this.collection = [];\n    } else {\n      reduction = options.path.split('/').reduce(function(agg, name) {\n        agg.path += '/' + name;\n        agg.collection.push({\n          name: name,\n          path: agg.path\n        });\n        return agg;\n      }, {\n        collection: [],\n        path: ''\n      });\n      return this.collection = reduction.collection;\n    }\n  };\n\n  BreadcrumbsView.prototype.afterRender = function() {\n    var folder, _i, _len, _ref;\n    this.crumbsElem = this.$('#crumbs');\n    if (this.collection.length === 0) {\n      this.toggleHomeEdge('round');\n      return this;\n    }\n    this.toggleHomeEdge('arrow');\n    _ref = this.collection;\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      folder = _ref[_i];\n      this.$('#crumbs ul').append(this.itemview({\n        model: folder\n      }));\n    }\n    this.crumbsElem.scroll((function(_this) {\n      return function(ev) {\n        if (ev.target.scrollLeft === 0) {\n          return _this.toggleHomeEdge('arrow');\n        } else {\n          return _this.toggleHomeEdge('truncated');\n        }\n      };\n    })(this));\n    return this;\n  };\n\n  BreadcrumbsView.prototype.toggleHomeEdge = function(edgeStyle) {\n    switch (edgeStyle) {\n      case 'truncated':\n        this.$('.home .round').hide();\n        this.$('.home .arrow').show();\n        return this.$('#truncated').show();\n      case 'arrow':\n        this.$('.home .round').hide();\n        this.$('.home .arrow').show();\n        return this.$('#truncated').hide();\n      case 'round':\n        this.$('.home .round').show();\n        this.$('.home .arrow').hide();\n        return this.$('#truncated').hide();\n    }\n  };\n\n  BreadcrumbsView.prototype.scrollLeft = function() {\n    return this.crumbsElem.scrollLeft(this.crumbsElem.outerWidth());\n  };\n\n  BreadcrumbsView.prototype.scrollRight = function() {\n    return this.crumbsElem.scrollLeft(-20);\n  };\n\n  return BreadcrumbsView;\n\n})(BaseView);\n","var BaseView, ConfigView, log,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"config view\",\n  date: true\n});\n\nmodule.exports = ConfigView = (function(_super) {\n  __extends(ConfigView, _super);\n\n  function ConfigView() {\n    return ConfigView.__super__.constructor.apply(this, arguments);\n  }\n\n  ConfigView.prototype.template = require('../templates/config');\n\n  ConfigView.prototype.menuEnabled = true;\n\n  ConfigView.prototype.events = function() {\n    return {\n      'tap #configDone': 'configDone',\n      'tap #redbtn': 'redBtn',\n      'tap #synchrobtn': 'synchroBtn',\n      'tap #sendlogbtn': 'sendlogBtn',\n      'tap #contactSyncCheck': 'saveChanges',\n      'tap #imageSyncCheck': 'saveChanges',\n      'tap #wifiSyncCheck': 'saveChanges',\n      'tap #cozyNotificationsCheck': 'saveChanges'\n    };\n  };\n\n  ConfigView.prototype.getRenderData = function() {\n    var config;\n    config = app.replicator.config.toJSON();\n    return _.extend({}, config, {\n      lastSync: this.formatDate(config != null ? config.lastSync : void 0),\n      lastBackup: this.formatDate(config != null ? config.lastBackup : void 0),\n      firstRun: app.isFirstRun,\n      locale: app.locale,\n      appVersion: app.replicator.config.appVersion()\n    });\n  };\n\n  ConfigView.prototype.formatDate = function(date) {\n    if (!date) {\n      return t('never');\n    } else {\n      if (!(date instanceof Date)) {\n        date = new Date(date);\n      }\n      return date.toLocaleDateString() + ' ' + date.toTimeString();\n    }\n  };\n\n  ConfigView.prototype.configDone = function() {\n    return app.router.navigate('first-sync', {\n      trigger: true\n    });\n  };\n\n  ConfigView.prototype.redBtn = function() {\n    if (confirm(t('confirm message'))) {\n      app.replicator.set('inSync', true);\n      app.replicator.set('backup_step', 'destroying database');\n      return app.replicator.destroyDB((function(_this) {\n        return function(err) {\n          if (err) {\n            log.error(err);\n            return alert(err.message);\n          }\n          $('#redbtn').text(t('done'));\n          return window.location.reload(true);\n        };\n      })(this));\n    }\n  };\n\n  ConfigView.prototype.synchroBtn = function() {\n    if (confirm(t('confirm message'))) {\n      return app.router.navigate('first-sync', {\n        trigger: true\n      });\n    }\n  };\n\n  ConfigView.prototype.sendlogBtn = function() {\n    var query;\n    query = {\n      subject: \"Log from cozy-mobile v\" + app.replicator.config.appVersion(),\n      body: \"Describe the problem here:\\n\\n\\n########################\\n# Log Trace: please don't touch (or tell us what)\\n##\\n\\n\" + (log.getTraces().join('\\n'))\n    };\n    return window.open(\"mailto:guillaume@cozycloud.cc?\" + $.param(query), \"_system\");\n  };\n\n  ConfigView.prototype.saveChanges = function() {\n    var checkboxes;\n    log.info(\"Save changes\");\n    checkboxes = this.$('#contactSyncCheck, #imageSyncCheck,' + '#wifiSyncCheck, #cozyNotificationsCheck' + '#configDone');\n    checkboxes.prop('disabled', true);\n    return app.replicator.config.save({\n      syncContacts: this.$('#contactSyncCheck').is(':checked'),\n      syncImages: this.$('#imageSyncCheck').is(':checked'),\n      syncOnWifi: this.$('#wifiSyncCheck').is(':checked'),\n      cozyNotifications: this.$('#cozyNotificationsCheck').is(':checked')\n    }, function() {\n      return checkboxes.prop('disabled', false);\n    });\n  };\n\n  return ConfigView;\n\n})(BaseView);\n","var BaseView, DeviceNamePickerView, log,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"DeviceNamePickerView\",\n  date: true\n});\n\nmodule.exports = DeviceNamePickerView = (function(_super) {\n  __extends(DeviceNamePickerView, _super);\n\n  function DeviceNamePickerView() {\n    return DeviceNamePickerView.__super__.constructor.apply(this, arguments);\n  }\n\n  DeviceNamePickerView.prototype.className = 'list';\n\n  DeviceNamePickerView.prototype.template = require('../templates/device_name_picker');\n\n  DeviceNamePickerView.prototype.events = function() {\n    return {\n      'click #btn-save': 'doSave',\n      'blur #input-device': 'onCompleteDefaultValue',\n      'focus #input-device': 'onRemoveDefaultValue',\n      'click #btn-back': 'doBack',\n      'keypress #input-device': 'blurIfEnter'\n    };\n  };\n\n  DeviceNamePickerView.prototype.doBack = function() {\n    return app.router.navigate('login', {\n      trigger: true\n    });\n  };\n\n  DeviceNamePickerView.prototype.blurIfEnter = function(e) {\n    if (e.keyCode === 13) {\n      return this.$('#input-device').blur();\n    }\n  };\n\n  DeviceNamePickerView.prototype.doSave = function() {\n    var config, device;\n    if (this.saving) {\n      return null;\n    }\n    this.saving = $('#btn-save').text();\n    if (this.error) {\n      this.error.remove();\n    }\n    device = this.$('#input-device').val();\n    if (!device) {\n      return this.displayError('all fields are required');\n    }\n    config = app.loginConfig;\n    config.deviceName = device;\n    $('#btn-save').text(t('registering...'));\n    return app.replicator.registerRemote(config, (function(_this) {\n      return function(err) {\n        if (err != null) {\n          log.error(err);\n          return _this.displayError(t(err.message));\n        } else {\n          delete app.loginConfig;\n          app.isFirstRun = true;\n          return app.router.navigate('config', {\n            trigger: true\n          });\n        }\n      };\n    })(this));\n  };\n\n  DeviceNamePickerView.prototype.onCompleteDefaultValue = function() {\n    var device;\n    device = this.$('#input-device').val();\n    if (device === '') {\n      return this.$('#input-device').val(t('device name placeholder'));\n    }\n  };\n\n  DeviceNamePickerView.prototype.onRemoveDefaultValue = function() {\n    var device;\n    device = this.$('#input-device').val();\n    if (device === t('device name placeholder')) {\n      return this.$('#input-device').val('');\n    }\n  };\n\n  DeviceNamePickerView.prototype.displayError = function(text, field) {\n    $('#btn-save').text(this.saving);\n    this.saving = false;\n    if (this.error) {\n      this.error.remove();\n    }\n    if (~text.indexOf('CORS request rejected')) {\n      text = t('connection failure');\n    }\n    this.error = $('<div>').addClass('error-msg');\n    this.error.text(text);\n    return this.$(field || 'label').after(this.error);\n  };\n\n  return DeviceNamePickerView;\n\n})(BaseView);\n","var BaseView, FirstSyncView, LAST_STEP, log,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nLAST_STEP = 5;\n\nlog = require('/lib/persistent_log')({\n  prefix: \"FirstSyncView\",\n  date: true\n});\n\nmodule.exports = FirstSyncView = (function(_super) {\n  __extends(FirstSyncView, _super);\n\n  function FirstSyncView() {\n    return FirstSyncView.__super__.constructor.apply(this, arguments);\n  }\n\n  FirstSyncView.prototype.className = 'list';\n\n  FirstSyncView.prototype.template = require('../templates/first_sync');\n\n  FirstSyncView.prototype.events = function() {\n    return {\n      'tap #btn-end': 'end'\n    };\n  };\n\n  FirstSyncView.prototype.getRenderData = function() {\n    var buttonText, messageText, step;\n    step = app.replicator.get('initialReplicationStep');\n    log.info(\"onChange : \" + step);\n    if (step === LAST_STEP) {\n      messageText = t('ready message');\n      buttonText = t('end');\n    } else {\n      messageText = t(\"message step \" + step);\n      buttonText = t('waiting...');\n    }\n    return {\n      messageText: messageText,\n      buttonText: buttonText\n    };\n  };\n\n  FirstSyncView.prototype.initialize = function() {\n    this.listenTo(app.replicator, 'change:initialReplicationStep', this.onChange);\n    log.info('starting first replication');\n    return app.replicator.initialReplication(function(err) {\n      if (err) {\n        log.error(err);\n        alert(t(err.message));\n        return setImmediate(function() {\n          return app.router.navigate('config', {\n            trigger: true\n          });\n        });\n      }\n    });\n  };\n\n  FirstSyncView.prototype.onChange = function(replicator) {\n    var step;\n    step = replicator.get('initialReplicationStep');\n    this.$('#finishSync .progress').text(t(\"message step \" + step));\n    if (step === LAST_STEP) {\n      return this.render();\n    }\n  };\n\n  FirstSyncView.prototype.end = function() {\n    var step;\n    step = parseInt(app.replicator.get('initialReplicationStep'));\n    log.info(\"end \" + step);\n    if (step !== LAST_STEP) {\n      return;\n    }\n    app.isFirstRun = false;\n    return app.regularStart();\n  };\n\n  return FirstSyncView;\n\n})(BaseView);\n","var CollectionView, FolderView,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCollectionView = require('../lib/view_collection');\n\nmodule.exports = FolderView = (function(_super) {\n  __extends(FolderView, _super);\n\n  function FolderView() {\n    this.checkScroll = __bind(this.checkScroll, this);\n    this.displaySlider = __bind(this.displaySlider, this);\n    this.remove = __bind(this.remove, this);\n    this.appendView = __bind(this.appendView, this);\n    this.onChange = __bind(this.onChange, this);\n    return FolderView.__super__.constructor.apply(this, arguments);\n  }\n\n  FolderView.prototype.className = 'list';\n\n  FolderView.prototype.itemview = require('./folder_line');\n\n  FolderView.prototype.menuEnabled = true;\n\n  FolderView.prototype.events = function() {\n    return {\n      'tap .cache-indicator': 'displaySlider',\n      'hold .item': 'displaySlider'\n    };\n  };\n\n  FolderView.prototype.isParentOf = function(otherFolderView) {\n    if (this.collection.path === null) {\n      return true;\n    }\n    if (this.collection.isSearch()) {\n      return false;\n    }\n    if (!otherFolderView.collection.path) {\n      return false;\n    }\n    return -1 !== otherFolderView.collection.path.indexOf(this.collection.path);\n  };\n\n  FolderView.prototype.initialize = function() {\n    FolderView.__super__.initialize.apply(this, arguments);\n    return this.listenTo(this.collection, 'sync', this.onChange);\n  };\n\n  FolderView.prototype.afterRender = function() {\n    var _ref;\n    if ((_ref = this.ionicView) != null) {\n      _ref.destroy();\n    }\n    FolderView.__super__.afterRender.apply(this, arguments);\n    return this.ionicView = new ionic.views.ListView({\n      el: this.$el[0],\n      _handleDrag: (function(_this) {\n        return function(e) {\n          var gesture;\n          gesture = e.gesture;\n          if (gesture.direction === 'up') {\n            gesture.deltaX = 0;\n            gesture.angle = -90;\n            gesture.distance = -1 * gesture.deltaY;\n            gesture.velocityX = 0;\n          } else if (gesture.direction === 'down') {\n            gesture.deltaX = 0;\n            gesture.angle = 90;\n            gesture.distance = gesture.deltaY;\n            gesture.velocityX = 0;\n          } else if (gesture.direction === 'left') {\n            gesture.deltaY = 0;\n            gesture.angle = 180;\n            gesture.distance = gesture.deltaX;\n            gesture.velocityY = 0;\n          } else if (gesture.direction === 'right') {\n            gesture.deltaY = 0;\n            gesture.angle = 0;\n            gesture.distance = gesture.deltaX;\n            gesture.velocityY = 0;\n          }\n          _this.checkScroll();\n          if (!(app.layout.isMenuOpen() || e.gesture.deltaX > 0)) {\n            ionic.views.ListView.prototype._handleDrag.apply(_this.ionicView, arguments);\n            e.preventDefault();\n            return e.stopPropagation();\n          }\n        };\n      })(this)\n    });\n  };\n\n  FolderView.prototype.onChange = function() {\n    var message;\n    app.layout.ionicScroll.resize();\n    this.$('#empty-message').remove();\n    if (_.size(this.views) === 0) {\n      message = this.collection.notloaded ? 'loading' : this.collection.isSearch() ? 'no results' : 'this folder is empty';\n      return $('<li class=\"item\" id=\"empty-message\">').text(t(message)).appendTo(this.$el);\n    } else if (!this.collection.allPagesLoaded) {\n      return $('<li class=\"item\" id=\"empty-message\">').text(t('loading')).appendTo(this.$el);\n    }\n  };\n\n  FolderView.prototype.appendView = function(view) {\n    FolderView.__super__.appendView.apply(this, arguments);\n    return view.parent = this;\n  };\n\n  FolderView.prototype.remove = function() {\n    FolderView.__super__.remove.apply(this, arguments);\n    return this.collection.cancelFetchAdditional();\n  };\n\n  FolderView.prototype.displaySlider = function(event) {\n    var op;\n    op = new ionic.SlideDrag({\n      el: this.ionicView.el,\n      canSwipe: function() {\n        return true;\n      }\n    });\n    op.start({\n      target: event.target\n    });\n    if (op._currentDrag.startOffsetX === 0) {\n      op.end({\n        gesture: {\n          deltaX: 0 - op._currentDrag.buttonsWidth,\n          direction: 'right'\n        }\n      });\n      ionic.requestAnimationFrame((function(_this) {\n        return function() {\n          return _this.ionicView._lastDragOp = op;\n        };\n      })(this));\n    } else {\n      this.ionicView.clearDragEffects();\n    }\n    event.preventDefault();\n    return event.stopPropagation();\n  };\n\n  FolderView.prototype.checkScroll = function() {\n    var triggerPoint;\n    triggerPoint = $('#viewsPlaceholder').height() * 2;\n    if (app.layout.ionicScroll.getValues().top + triggerPoint > app.layout.ionicScroll.getScrollMax().top) {\n      return this.loadMore();\n    }\n  };\n\n  FolderView.prototype.loadMore = function(callback) {\n    if (!this.collection.notLoaded && !this.isLoading && !this.collection.allPagesLoaded) {\n      this.isLoading = true;\n      return this.collection.loadNextPage((function(_this) {\n        return function(err) {\n          _this.isLoading = false;\n          return typeof callback === \"function\" ? callback() : void 0;\n        };\n      })(this));\n    }\n  };\n\n  return FolderView;\n\n})(CollectionView);\n","var BaseView, FolderLineView, log,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"FolderLineView\",\n  date: true\n});\n\nmodule.exports = FolderLineView = (function(_super) {\n  __extends(FolderLineView, _super);\n\n  function FolderLineView() {\n    this.removeFromCache = __bind(this.removeFromCache, this);\n    this.addToCache = __bind(this.addToCache, this);\n    this.onClick = __bind(this.onClick, this);\n    this.updateProgress = __bind(this.updateProgress, this);\n    this.hideProgress = __bind(this.hideProgress, this);\n    this.displayProgress = __bind(this.displayProgress, this);\n    this.setCacheIcon = __bind(this.setCacheIcon, this);\n    this.afterRender = __bind(this.afterRender, this);\n    this.initialize = __bind(this.initialize, this);\n    return FolderLineView.__super__.constructor.apply(this, arguments);\n  }\n\n  FolderLineView.prototype.tagName = 'a';\n\n  FolderLineView.prototype.template = require('../templates/folder_line');\n\n  FolderLineView.prototype.events = {\n    'tap .item-content': 'onClick',\n    'tap .item-options .download': 'addToCache',\n    'tap .item-options .uncache': 'removeFromCache'\n  };\n\n  FolderLineView.prototype.className = 'item item-icon-left item-icon-right item-complex';\n\n  FolderLineView.prototype.initialize = function() {\n    return this.listenTo(this.model, 'change', this.render);\n  };\n\n  FolderLineView.prototype.getRenderData = function() {\n    return _.extend(FolderLineView.__super__.getRenderData.apply(this, arguments), {\n      isFolder: this.model.isFolder()\n    });\n  };\n\n  FolderLineView.prototype.afterRender = function() {\n    this.$el[0].dataset.folderid = this.model.get('_id');\n    if (this.model.isDeviceFolder) {\n      return this.$('.ion-folder').css({\n        color: '#34a6ff'\n      });\n    }\n  };\n\n  FolderLineView.prototype.setCacheIcon = function(klass) {\n    var icon, _ref, _ref1;\n    icon = this.$('.cache-indicator');\n    icon.removeClass('ion-warning ion-looping ion-ios7-cloud-download-outline');\n    icon.removeClass('ion-ios7-download-outline');\n    icon.append(klass);\n    return (_ref = this.parent) != null ? (_ref1 = _ref.ionicView) != null ? _ref1.clearDragEffects() : void 0 : void 0;\n  };\n\n  FolderLineView.prototype.displayProgress = function() {\n    this.downloading = true;\n    this.setCacheIcon('<img src=\"img/spinner-grey.svg\"></img>');\n    this.progresscontainer = $('<div class=\"item-progress\"></div>').append(this.progressbar = $('<div class=\"item-progress-bar\"></div>'));\n    return this.progresscontainer.appendTo(this.$el);\n  };\n\n  FolderLineView.prototype.hideProgress = function(err, incache) {\n    var version, _ref;\n    this.downloading = false;\n    if (err) {\n      alert(err);\n    }\n    incache = app.replicator.fileInFileSystem(this.model.attributes);\n    version = app.replicator.fileVersion(this.model.attributes);\n    if ((incache != null) && incache !== this.model.get('incache')) {\n      this.model.set({\n        incache: incache\n      });\n    }\n    if ((version != null) && version !== this.model.get('version')) {\n      this.model.set({\n        version: version\n      });\n    }\n    if ((_ref = this.progresscontainer) != null) {\n      _ref.remove();\n    }\n    return this.render();\n  };\n\n  FolderLineView.prototype.updateProgress = function(done, total) {\n    var _ref;\n    return (_ref = this.progressbar) != null ? _ref.css('width', (100 * done / total) + '%') : void 0;\n  };\n\n  FolderLineView.prototype.getOnDownloadedCallback = function(callback) {\n    callback = callback || function() {};\n    return (function(_this) {\n      return function(err, url) {\n        _this.hideProgress();\n        if (err) {\n          log.error(err);\n          return alert(t(err.message));\n        }\n        _this.model.set({\n          incache: true\n        });\n        _this.model.set({\n          version: app.replicator.fileVersion(_this.model.attributes)\n        });\n        return callback(err, url);\n      };\n    })(this);\n  };\n\n  FolderLineView.prototype.onClick = function(event) {\n    var path;\n    if ($(event.target).closest('.cache-indicator').length) {\n      return true;\n    }\n    if (this.downloading) {\n      return true;\n    }\n    if (this.model.isFolder()) {\n      path = this.model.get('path') + '/' + this.model.get('name');\n      app.router.navigate(\"#folder\" + path, {\n        trigger: true\n      });\n      return true;\n    }\n    this.displayProgress();\n    return app.replicator.getBinary(this.model.attributes, this.updateProgress, this.getOnDownloadedCallback((function(_this) {\n      return function(err, url) {\n        app.backFromOpen = true;\n        return ExternalFileUtil.openWith(url, '', void 0, function(success) {}, function(err) {\n          if (0 === (err != null ? err.indexOf('No Activity found') : void 0)) {\n            err = t('no activity found');\n          }\n          alert(err.message);\n          return log.error(err);\n        });\n      };\n    })(this)));\n  };\n\n  FolderLineView.prototype.addToCache = function() {\n    if (this.downloading) {\n      return true;\n    }\n    this.displayProgress();\n    if (this.model.isFolder()) {\n      return app.replicator.getBinaryFolder(this.model.attributes, this.updateProgress, this.getOnDownloadedCallback());\n    } else {\n      return app.replicator.getBinary(this.model.attributes, this.updateProgress, this.getOnDownloadedCallback());\n    }\n  };\n\n  FolderLineView.prototype.removeFromCache = function() {\n    var onremoved;\n    if (this.downloading) {\n      return true;\n    }\n    this.displayProgress();\n    onremoved = (function(_this) {\n      return function(err) {\n        _this.hideProgress();\n        if (err) {\n          return alert(err);\n        }\n        return _this.model.set({\n          incache: false\n        });\n      };\n    })(this);\n    if (this.model.isFolder()) {\n      return app.replicator.removeLocalFolder(this.model.attributes, onremoved);\n    } else {\n      return app.replicator.removeLocal(this.model.attributes, onremoved);\n    }\n  };\n\n  FolderLineView.prototype.mimeClasses = {\n    'application/octet-stream': 'type-file',\n    'application/x-binary': 'type-binary',\n    'text/plain': 'type-text',\n    'text/richtext': 'type-text',\n    'application/x-rtf': 'type-text',\n    'application/rtf': 'type-text',\n    'application/msword': 'type-text',\n    'application/x-iwork-pages-sffpages': 'type-text',\n    'application/mspowerpoint': 'type-presentation',\n    'application/vnd.ms-powerpoint': 'type-presentation',\n    'application/x-mspowerpoint': 'type-presentation',\n    'application/x-iwork-keynote-sffkey': 'type-presentation',\n    'application/excel': 'type-spreadsheet',\n    'application/x-excel': 'type-spreadsheet',\n    'aaplication/vnd.ms-excel': 'type-spreadsheet',\n    'application/x-msexcel': 'type-spreadsheet',\n    'application/x-iwork-numbers-sffnumbers': 'type-spreadsheet',\n    'application/pdf': 'type-pdf',\n    'text/html': 'type-code',\n    'text/asp': 'type-code',\n    'text/css': 'type-code',\n    'application/x-javascript': 'type-code',\n    'application/x-lisp': 'type-code',\n    'application/xml': 'type-code',\n    'text/xml': 'type-code',\n    'application/x-sh': 'type-code',\n    'text/x-script.python': 'type-code',\n    'application/x-bytecode.python': 'type-code',\n    'text/x-java-source': 'type-code',\n    'application/postscript': 'type-image',\n    'image/gif': 'type-image',\n    'image/jpg': 'type-image',\n    'image/jpeg': 'type-image',\n    'image/pjpeg': 'type-image',\n    'image/x-pict': 'type-image',\n    'image/pict': 'type-image',\n    'image/png': 'type-image',\n    'image/x-pcx': 'type-image',\n    'image/x-portable-pixmap': 'type-image',\n    'image/x-tiff': 'type-image',\n    'image/tiff': 'type-image',\n    'audio/aiff': 'type-audio',\n    'audio/x-aiff': 'type-audio',\n    'audio/midi': 'type-audio',\n    'audio/x-midi': 'type-audio',\n    'audio/x-mid': 'type-audio',\n    'audio/mpeg': 'type-audio',\n    'audio/x-mpeg': 'type-audio',\n    'audio/mpeg3': 'type-audio',\n    'audio/x-mpeg3': 'type-audio',\n    'audio/wav': 'type-audio',\n    'audio/x-wav': 'type-audio',\n    'video/avi': 'type-video',\n    'video/mpeg': 'type-video',\n    'video/mp4': 'type-video',\n    'application/zip': 'type-archive',\n    'multipart/x-zip': 'type-archive',\n    'multipart/x-zip': 'type-archive',\n    'application/x-bzip': 'type-archive',\n    'application/x-bzip2': 'type-archive',\n    'application/x-gzip': 'type-archive',\n    'application/x-compress': 'type-archive',\n    'application/x-compressed': 'type-archive',\n    'application/x-zip-compressed': 'type-archive',\n    'application/x-apple-diskimage': 'type-archive',\n    'multipart/x-gzip': 'type-archive'\n  };\n\n  return FolderLineView;\n\n})(BaseView);\n","var BaseView, BreadcrumbsView, FolderView, Layout, Menu,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nFolderView = require('./folder');\n\nMenu = require('./menu');\n\nBreadcrumbsView = require('./breadcrumbs');\n\nmodule.exports = Layout = (function(_super) {\n  __extends(Layout, _super);\n\n  function Layout() {\n    this.onBackButtonClicked = __bind(this.onBackButtonClicked, this);\n    this.onSearchButtonClicked = __bind(this.onSearchButtonClicked, this);\n    this.onMenuButtonClicked = __bind(this.onMenuButtonClicked, this);\n    this.setTitle = __bind(this.setTitle, this);\n    this.setBackButton = __bind(this.setBackButton, this);\n    this.closeMenu = __bind(this.closeMenu, this);\n    this.isMenuOpen = __bind(this.isMenuOpen, this);\n    return Layout.__super__.constructor.apply(this, arguments);\n  }\n\n  Layout.prototype.template = require('../templates/layout');\n\n  Layout.prototype.events = function() {\n    return {\n      'tap #btn-back': 'onBackButtonClicked',\n      'tap #btn-menu': 'onMenuButtonClicked'\n    };\n  };\n\n  Layout.prototype.initialize = function() {\n    var OpEvents;\n    document.addEventListener(\"menubutton\", this.onMenuButtonClicked, false);\n    document.addEventListener(\"searchbutton\", this.onSearchButtonClicked, false);\n    document.addEventListener(\"backbutton\", this.onBackButtonClicked, false);\n    this.listenTo(app.replicator, 'change:inSync change:inBackup', (function(_this) {\n      return function() {\n        var inBackup, inSync;\n        inSync = app.replicator.get('inSync');\n        inBackup = app.replicator.get('inBackup');\n        return _this.spinner.toggle(inSync || inBackup);\n      };\n    })(this));\n    OpEvents = 'change:inBackup change:backup_step change:backup_step_done';\n    return this.listenTo(app.replicator, OpEvents, _.debounce((function(_this) {\n      return function() {\n        var step, text;\n        step = app.replicator.get('backup_step');\n        if (step && (step !== 'pictures_scan')) {\n          text = t(step);\n          if (app.replicator.get('backup_step_done')) {\n            text += \": \" + (app.replicator.get('backup_step_done'));\n            text += \"/\" + (app.replicator.get('backup_step_total'));\n          }\n          _this.backupIndicator.text(text).parent().slideDown();\n          return _this.viewsPlaceholder.addClass('has-subheader');\n        } else {\n          _this.backupIndicator.parent().slideUp();\n          return _this.viewsPlaceholder.removeClass('has-subheader');\n        }\n      };\n    })(this), 100));\n  };\n\n  Layout.prototype.afterRender = function() {\n    this.menu = new Menu();\n    this.menu.render();\n    this.$el.append(this.menu.$el);\n    this.container = this.$('#container');\n    this.viewsPlaceholder = this.$('#viewsPlaceholder');\n    this.viewsBlock = this.viewsPlaceholder.find('.scroll');\n    this.backButton = this.container.find('#btn-back');\n    this.menuButton = this.container.find('#btn-menu');\n    this.iconLogo = this.container.find('#icon-logo');\n    this.spinner = this.container.find('#headerSpinner');\n    this.spinner.hide();\n    this.title = this.container.find('#title');\n    this.backupIndicator = this.container.find('#backupIndicator');\n    this.backupIndicator.parent().hide();\n    this.ionicContainer = new ionic.views.SideMenuContent({\n      el: this.container[0]\n    });\n    this.ionicMenu = new ionic.views.SideMenu({\n      el: this.menu.$el[0],\n      width: 270\n    });\n    this.controller = new ionic.controllers.SideMenuController({\n      content: this.ionicContainer,\n      left: this.ionicMenu\n    });\n    this.ionicScroll = new ionic.views.Scroll({\n      el: this.viewsPlaceholder[0],\n      bouncing: false\n    });\n    this.ionicScroll.scrollTo(1, 0, true, null);\n    return this.ionicScroll.scrollTo(0, 0, true, null);\n  };\n\n  Layout.prototype.isMenuOpen = function() {\n    return this.controller.isOpenLeft();\n  };\n\n  Layout.prototype.closeMenu = function() {\n    return this.controller.toggleLeft(false);\n  };\n\n  Layout.prototype.setBackButton = function(href, icon) {\n    this.backButton.attr('href', href);\n    this.backButton.removeClass('ion-home ion-ios7-arrow-back');\n    return this.backButton.addClass('ion-' + icon);\n  };\n\n  Layout.prototype.setTitle = function(text) {\n    this.$('#breadcrumbs').remove();\n    this.title.text(text);\n    return this.title.show();\n  };\n\n  Layout.prototype.setBreadcrumbs = function(path) {\n    var breadcrumbsView;\n    this.$('#breadcrumbs').remove();\n    this.title.hide();\n    this.iconLogo.hide();\n    breadcrumbsView = new BreadcrumbsView({\n      path: path\n    });\n    this.title.after(breadcrumbsView.render().$el);\n    return breadcrumbsView.scrollLeft();\n  };\n\n  Layout.prototype.transitionTo = function(view) {\n    var $next, currClass, menuEnabled, nextClass, transitionend, type, _ref;\n    this.closeMenu();\n    $next = view.render().$el;\n    menuEnabled = (view.menuEnabled != null) && view.menuEnabled;\n    this.ionicMenu.setIsEnabled(menuEnabled);\n    if (this.currentView instanceof FolderView && view instanceof FolderView) {\n      type = this.currentView.isParentOf(view) ? 'left' : 'right';\n    } else {\n      type = 'none';\n    }\n    if (type === 'none') {\n      if ((_ref = this.currentView) != null) {\n        _ref.remove();\n      }\n      this.viewsBlock.append($next);\n      this.ionicScroll.hintResize();\n      return this.currentView = view;\n    } else {\n      nextClass = type === 'left' ? 'sliding-next' : 'sliding-prev';\n      currClass = type === 'left' ? 'sliding-prev' : 'sliding-next';\n      $next.addClass(nextClass);\n      this.viewsBlock.append($next);\n      $next.width();\n      this.currentView.$el.addClass(currClass);\n      $next.removeClass(nextClass);\n      transitionend = 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend';\n      return $next.one(transitionend, _.once((function(_this) {\n        return function() {\n          _this.currentView.remove();\n          _this.currentView = view;\n          return _this.ionicScroll.scrollTo(0, 0, true, null);\n        };\n      })(this)));\n    }\n  };\n\n  Layout.prototype.onMenuButtonClicked = function() {\n    this.menu.reset();\n    return this.controller.toggleLeft();\n  };\n\n  Layout.prototype.onSearchButtonClicked = function() {\n    this.onMenuButtonClicked();\n    return this.$('#search-input').focus();\n  };\n\n  Layout.prototype.onBackButtonClicked = function(event) {\n    if (this.isMenuOpen()) {\n      return this.closeMenu();\n    } else if (location.href.indexOf('#folder/') === (location.href.length - 8)) {\n      if (window.confirm(t(\"confirm exit message\"))) {\n        return navigator.app.exitApp();\n      }\n    } else {\n      return window.history.back();\n    }\n  };\n\n  return Layout;\n\n})(BaseView);\n","var BaseView, LoginView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = LoginView = (function(_super) {\n  __extends(LoginView, _super);\n\n  function LoginView() {\n    return LoginView.__super__.constructor.apply(this, arguments);\n  }\n\n  LoginView.prototype.className = 'list';\n\n  LoginView.prototype.template = require('../templates/login');\n\n  LoginView.prototype.events = function() {\n    return {\n      'click #btn-save': 'doSave',\n      'click #input-pass': 'doComplete',\n      \"click a[target='_system']\": 'openInSystemBrowser'\n    };\n  };\n\n  LoginView.prototype.getRenderData = function() {\n    var defaultValue;\n    defaultValue = app.loginConfig || {\n      cozyURL: '',\n      password: ''\n    };\n    return {\n      defaultValue: defaultValue\n    };\n  };\n\n  LoginView.prototype.afterRender = function() {\n    this.$('.welcome').html(t('cozy welcome'));\n    this.$('.welcome-message').html(t('cozy welcome message'));\n    return this.$('.no-account').html(t('cozy welcome no account'));\n  };\n\n  LoginView.prototype.doComplete = function() {\n    var url;\n    url = this.$('#input-url').val();\n    if (url.indexOf('.') === -1 && url.length > 0) {\n      return this.$('#input-url').val(url + \".cozycloud.cc\");\n    }\n  };\n\n  LoginView.prototype.doSave = function() {\n    var config, pass, url;\n    if (this.saving) {\n      return null;\n    }\n    this.saving = $('#btn-save').text();\n    if (this.error) {\n      this.error.remove();\n    }\n    url = this.$('#input-url').val();\n    pass = this.$('#input-pass').val();\n    if (!(url && pass)) {\n      return this.displayError(t('all fields are required'));\n    }\n    if (url.slice(0, 4) === 'http') {\n      url = url.replace('https://', '').replace('http://', '');\n      this.$('#input-url').val(url);\n    }\n    if (url[url.length - 1] === '/') {\n      this.$('#input-url').val(url = url.slice(0, -1));\n    }\n    config = {\n      cozyURL: url,\n      password: pass\n    };\n    $('#btn-save').text(t('authenticating...'));\n    return app.replicator.checkCredentials(config, (function(_this) {\n      return function(error) {\n        if (error != null) {\n          return _this.displayError(error);\n        } else {\n          app.loginConfig = config;\n          return app.router.navigate('device-name-picker', {\n            trigger: true\n          });\n        }\n      };\n    })(this));\n  };\n\n  LoginView.prototype.displayError = function(text, field) {\n    $('#btn-save').text(this.saving);\n    this.saving = false;\n    if (this.error) {\n      this.error.remove();\n    }\n    if (~text.indexOf('CORS request rejected')) {\n      text = t('connection failure');\n    }\n    this.error = $('<div>').addClass('error-msg');\n    this.error.html(text);\n    return this.$(field || '#btn-save').before(this.error);\n  };\n\n  LoginView.prototype.openInSystemBrowser = function(e) {\n    window.open(e.currentTarget.href, '_system', '');\n    e.preventDefault();\n    return false;\n  };\n\n  return LoginView;\n\n})(BaseView);\n","var BaseView, Menu, log,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nlog = require('/lib/persistent_log')({\n  prefix: \"Menu\",\n  date: true\n});\n\nmodule.exports = Menu = (function(_super) {\n  __extends(Menu, _super);\n\n  function Menu() {\n    this.doSearchIfEnter = __bind(this.doSearchIfEnter, this);\n    return Menu.__super__.constructor.apply(this, arguments);\n  }\n\n  Menu.prototype.id = 'menu';\n\n  Menu.prototype.className = 'menu menu-left';\n\n  Menu.prototype.template = require('../templates/menu');\n\n  Menu.prototype.events = {\n    'click #close-menu': 'closeMenu',\n    'click #syncButton': 'backup',\n    'click #btn-search': 'doSearch',\n    'click a.item': 'closeMenu',\n    'keydown #search-input': 'doSearchIfEnter'\n  };\n\n  Menu.prototype.afterRender = function() {\n    this.syncButton = this.$('#syncButton');\n    return this.backupButton = this.$('#backupButton');\n  };\n\n  Menu.prototype.closeMenu = function() {\n    return app.layout.closeMenu();\n  };\n\n  Menu.prototype.sync = function() {\n    if (app.replicator.get('inSync')) {\n      return;\n    }\n    return app.replicator.sync({}, function(err) {\n      var _ref, _ref1;\n      if (err) {\n        log.error(err);\n        alert(t(err.message != null ? err.message : \"no connection\"));\n      }\n      return (_ref = app.layout.currentView) != null ? (_ref1 = _ref.collection) != null ? _ref1.fetch() : void 0 : void 0;\n    });\n  };\n\n  Menu.prototype.test = function() {\n    return app.replicator.testSyncContacts(function(err) {\n      if (err) {\n        return alert(err);\n      }\n    });\n  };\n\n  Menu.prototype.backup = function() {\n    app.layout.closeMenu();\n    if (app.replicator.get('inBackup')) {\n      return this.sync();\n    } else {\n      return app.replicator.backup({\n        force: false\n      }, (function(_this) {\n        return function(err) {\n          var _ref, _ref1;\n          if (err) {\n            log.error(err);\n            alert(t(err.message));\n            return;\n          }\n          if ((_ref = app.layout.currentView) != null) {\n            if ((_ref1 = _ref.collection) != null) {\n              _ref1.fetch();\n            }\n          }\n          return _this.sync();\n        };\n      })(this));\n    }\n  };\n\n  Menu.prototype.doSearchIfEnter = function(event) {\n    if (event.which === 13) {\n      return this.doSearch();\n    }\n  };\n\n  Menu.prototype.doSearch = function() {\n    var val;\n    val = $('#search-input').val();\n    if (val.length === 0) {\n      return true;\n    }\n    app.layout.closeMenu();\n    return app.router.navigate('#search/' + val, {\n      trigger: true\n    });\n  };\n\n  Menu.prototype.reset = function() {\n    return this.$('#search-input').blur().val('');\n  };\n\n  return Menu;\n\n})(BaseView);\n","var Notifications, log,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\nlog = require('/lib/persistent_log')({\n  prefix: \"notifications\",\n  date: true\n});\n\nmodule.exports = Notifications = (function() {\n  _.extend(Notifications.prototype, Backbone.Events);\n\n  function Notifications(options) {\n    this.showNotification = __bind(this.showNotification, this);\n    this.markAsShown = __bind(this.markAsShown, this);\n    this.fetch = __bind(this.fetch, this);\n    this.onSync = __bind(this.onSync, this);\n    this.activate = __bind(this.activate, this);\n    options = options || {};\n    this.initialize.apply(this, arguments);\n  }\n\n  Notifications.prototype.initialize = function() {\n    var config;\n    config = app.replicator.config;\n    this.listenTo(config, 'change:cozyNotifications', this.activate);\n    return this.activate(config, config.get('cozyNotifications'));\n  };\n\n  Notifications.prototype.activate = function(config, activate) {\n    if (activate) {\n      this.listenTo(app.replicator, 'change:inSync', this.onSync);\n      return this.onSync();\n    } else {\n      return this.stopListening(app.replicator, 'change:inSync');\n    }\n  };\n\n  Notifications.prototype.onSync = function() {\n    var inSync;\n    inSync = app.replicator.get('inSync');\n    if (!inSync) {\n      return this.fetch();\n    }\n  };\n\n  Notifications.prototype.fetch = function() {\n    return app.replicator.db.query('NotificationsTemporary', {\n      include_docs: true\n    }, (function(_this) {\n      return function(err, notifications) {\n        return notifications.rows.forEach(function(notification) {\n          return _this.showNotification(notification.doc);\n        });\n      };\n    })(this));\n  };\n\n  Notifications.prototype.markAsShown = function(notification) {\n    return app.replicator.db.remove(notification, function(err) {\n      if (err) {\n        return log.error(\"Error while removing notification.\", err);\n      }\n    });\n  };\n\n  Notifications.prototype.showNotification = function(notification) {\n    var id;\n    id = parseInt(notification._id.slice(-7), 16);\n    if (isNaN(id)) {\n      id = notification.publishDate % 10000000;\n    }\n    cordova.plugins.notification.local.schedule({\n      id: id,\n      message: notification.text,\n      title: \"Cozy - \" + (notification.app || 'Notification'),\n      autoCancel: true\n    });\n    return this.markAsShown(notification);\n  };\n\n  return Notifications;\n\n})();\n"]}